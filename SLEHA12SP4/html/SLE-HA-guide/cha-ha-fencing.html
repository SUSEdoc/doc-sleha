<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><title>SLE HA 12 SP4 | Administration Guide | Fencing and STONITH</title><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes"/><link rel="stylesheet" type="text/css" href="static/css/style.css"/>
<link rel="schema.DC" href="http://purl.org/dc/elements/1.1/"/><link rel="schema.DCTERMS" href="http://purl.org/dc/terms/"/>
<meta name="title" content="Fencing and STONITH | SLE HA 12 SP4"/>
<meta name="description" content="Fencing is a very important concept in computer cluste…"/>
<meta name="product-name" content="SUSE Linux Enterprise High Availability"/>
<meta name="product-number" content="12 SP4"/>
<meta name="book-title" content="Administration Guide"/>
<meta name="chapter-title" content="Chapter 9. Fencing and STONITH"/>
<meta name="tracker-url" content="https://bugzilla.suse.com/enter_bug.cgi"/>
<meta name="tracker-type" content="bsc"/>
<meta name="tracker-bsc-component" content="Documentation"/>
<meta name="tracker-bsc-product" content="SUSE Linux Enterprise High Availability Extension 12 SP4"/>
<meta name="publisher" content="SUSE"/><meta property="og:title" content="Fencing and STONITH | SLE HA 12 SP4"/>
<meta property="og:description" content="Fencing is a very important concept in computer clusters for HA (High Availability). A cluster sometimes detects that one of…"/>
<meta property="og:type" content="article"/>
<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Fencing and STONITH | SLE HA 12 SP4"/>
<meta name="twitter:description" content="Fencing is a very important concept in computer clusters for HA (High Availability). A cluster sometimes detects that one of…"/>
<link rel="prev" href="cha-ha-agents.html" title="Chapter 8. Adding or Modifying Resource Agents"/><link rel="next" href="cha-ha-storage-protect.html" title="Chapter 10. Storage Protection and SBD"/><script type="text/javascript">

if ( window.location.protocol.toLowerCase() != 'file:' ) {
  document.write('<link rel="stylesheet" type="text/css" href="https://documentation.suse.com/docserv/res/fonts/poppins/poppins.css"></link>');
};

</script><noscript><link rel="stylesheet" type="text/css" href="https://documentation.suse.com/docserv/res/fonts/poppins/poppins.css"/></noscript><script src="static/js/jquery-1.12.4.min.js" type="text/javascript"> </script><script src="static/js/script.js" type="text/javascript"> </script><script src="static/js/highlight.min.js" type="text/javascript"> </script><script>

$(document).ready(function() {
  $('.verbatim-wrap.highlight').each(function(i, block) {
    hljs.highlightBlock(block);
  });
});
hljs.configure({
  useBR: false
});

</script><meta name="edit-url" content="https://github.com/SUSE/doc-sleha/edit/maintenance/SLEHA12SP4/xml/ha_fencing.xml"/></head><body class="draft wide offline js-off" onload="$('#betawarn-button-wrap').toggle();if (document.cookie.length > 0) {if (document.cookie.indexOf('betawarn=closed') != -1){$('#betawarn').toggle()}};"><div id="betawarn" style="position:fixed;bottom:0;z-index:9025;background-color:#FDE8E8;padding:1em;margin-left:10%;margin-right:10%;display:block;border-top:.75em solid #E11;width:80%"><p style="color:#333;margin:1em 0;padding:0;">This is a draft document that was built and uploaded automatically. It may document beta software and be incomplete or even incorrect. <strong>Use this document at your own risk.</strong></p> <div id="betawarn-button-wrap" style="display:none;margin:0;padding:0;"><a href="#" onclick="$('#betawarn').toggle();var d=new Date();d.setTime(d.getTime()+(0.5*24*60*60*1000));document.cookie='betawarn=closed; expires='+d.toUTCString()+'; path=/'; return false;" style="color:#333;text-decoration:underline;float:left;margin-top:.5em;padding:1em;display:block;background-color:#FABEBE;">I understand this is a draft</a></div></div><div class="bypass-block"><a href="#_content">Jump to content</a><a href="#_bottom-pagination">Jump to page navigation: previous page [access key p]/next page [access key n]</a></div><header id="_mainnav"><div class="growth-inhibitor"><img src="static/images/logo.svg" alt="Logo" class="logo"/></div></header><div class="crumbs"><div class="growth-inhibitor"><a class="crumb" href="index.html">Administration Guide</a><span> / </span><a class="crumb" href="part-config.html">Configuration and Administration</a><span> / </span><a class="crumb" href="cha-ha-fencing.html">Fencing and STONITH</a></div></div><main id="_content"><nav id="_side-toc-overall" class="side-toc"><div class="side-title">Administration Guide</div><ol><li><a href="pre-ha.html" class=" "><span class="title-number"> </span><span class="title-name">About This Guide</span></a></li><li><a href="part-install.html" class="has-children "><span class="title-number">I </span><span class="title-name">Installation and Setup</span></a><ol><li><a href="cha-ha-concepts.html" class=" "><span class="title-number">1 </span><span class="title-name">Product Overview</span></a></li><li><a href="cha-ha-requirements.html" class=" "><span class="title-number">2 </span><span class="title-name">System Requirements and Recommendations</span></a></li><li><a href="cha-ha-install.html" class=" "><span class="title-number">3 </span><span class="title-name">Installing SUSE Linux Enterprise High Availability</span></a></li><li><a href="cha-ha-setup.html" class=" "><span class="title-number">4 </span><span class="title-name">Using the YaST Cluster Module</span></a></li></ol></li><li class="active"><a href="part-config.html" class="has-children you-are-here"><span class="title-number">II </span><span class="title-name">Configuration and Administration</span></a><ol><li><a href="cha-ha-config-basics.html" class=" "><span class="title-number">5 </span><span class="title-name">Configuration and Administration Basics</span></a></li><li><a href="cha-conf-hawk2.html" class=" "><span class="title-number">6 </span><span class="title-name">Configuring and Managing Cluster Resources with Hawk2</span></a></li><li><a href="cha-ha-manual-config.html" class=" "><span class="title-number">7 </span><span class="title-name">Configuring and Managing Cluster Resources (Command Line)</span></a></li><li><a href="cha-ha-agents.html" class=" "><span class="title-number">8 </span><span class="title-name">Adding or Modifying Resource Agents</span></a></li><li><a href="cha-ha-fencing.html" class=" you-are-here"><span class="title-number">9 </span><span class="title-name">Fencing and STONITH</span></a></li><li><a href="cha-ha-storage-protect.html" class=" "><span class="title-number">10 </span><span class="title-name">Storage Protection and SBD</span></a></li><li><a href="cha-ha-acl.html" class=" "><span class="title-number">11 </span><span class="title-name">Access Control Lists</span></a></li><li><a href="cha-ha-netbonding.html" class=" "><span class="title-number">12 </span><span class="title-name">Network Device Bonding</span></a></li><li><a href="cha-ha-lb.html" class=" "><span class="title-number">13 </span><span class="title-name">Load Balancing</span></a></li><li><a href="cha-ha-geo.html" class=" "><span class="title-number">14 </span><span class="title-name">Geo Clusters (Multi-Site Clusters)</span></a></li></ol></li><li><a href="part-storage.html" class="has-children "><span class="title-number">III </span><span class="title-name">Storage and Data Replication</span></a><ol><li><a href="cha-ha-storage-dlm.html" class=" "><span class="title-number">15 </span><span class="title-name">Distributed Lock Manager (DLM)</span></a></li><li><a href="cha-ha-ocfs2.html" class=" "><span class="title-number">16 </span><span class="title-name">OCFS2</span></a></li><li><a href="cha-ha-gfs2.html" class=" "><span class="title-number">17 </span><span class="title-name">GFS2</span></a></li><li><a href="cha-ha-drbd.html" class=" "><span class="title-number">18 </span><span class="title-name">DRBD</span></a></li><li><a href="cha-ha-clvm.html" class=" "><span class="title-number">19 </span><span class="title-name">Cluster Logical Volume Manager (cLVM)</span></a></li><li><a href="cha-ha-cluster-md.html" class=" "><span class="title-number">20 </span><span class="title-name">Cluster Multi-device (Cluster MD)</span></a></li><li><a href="cha-ha-samba.html" class=" "><span class="title-number">21 </span><span class="title-name">Samba Clustering</span></a></li><li><a href="cha-ha-rear.html" class=" "><span class="title-number">22 </span><span class="title-name">Disaster Recovery with Relax-and-Recover (ReaR)</span></a></li></ol></li><li><a href="part-maintenance.html" class="has-children "><span class="title-number">IV </span><span class="title-name">Maintenance and Upgrade</span></a><ol><li><a href="cha-ha-maintenance.html" class=" "><span class="title-number">23 </span><span class="title-name">Executing Maintenance Tasks</span></a></li><li><a href="cha-ha-migration.html" class=" "><span class="title-number">24 </span><span class="title-name">Upgrading Your Cluster and Updating Software Packages</span></a></li></ol></li><li><a href="part-appendix.html" class="has-children "><span class="title-number">V </span><span class="title-name">Appendix</span></a><ol><li><a href="app-ha-troubleshooting.html" class=" "><span class="title-number">A </span><span class="title-name">Troubleshooting</span></a></li><li><a href="app-naming.html" class=" "><span class="title-number">B </span><span class="title-name">Naming Conventions</span></a></li><li><a href="app-ha-management.html" class=" "><span class="title-number">C </span><span class="title-name">Cluster Management Tools (Command Line)</span></a></li><li><a href="app-crmreport-nonroot.html" class=" "><span class="title-number">D </span><span class="title-name">Running Cluster Reports Without <code class="systemitem">root</code> Access</span></a></li><li><a href="app-ha-docupdates.html" class=" "><span class="title-number">E </span><span class="title-name">Documentation Updates</span></a></li></ol></li><li><a href="gl-heartb.html" class=" "><span class="title-number"> </span><span class="title-name">Glossary</span></a></li><li><a href="bk01apf.html" class=" "><span class="title-number">F </span><span class="title-name">GNU licenses</span></a></li> </ol> </nav><button id="_open-side-toc-overall" title="Contents"> </button><article class="documentation"><button id="_unfold-side-toc-page">On this page</button><section class="chapter" id="cha-ha-fencing" data-id-title="Fencing and STONITH"><div class="titlepage"><div><div class="version-info">Applies to  <span class="productname">SUSE Linux Enterprise High Availability</span> <span class="productnumber">12 SP4</span></div><div><div class="title-container"><h1 class="title"><span class="title-number-name"><span class="title-number">9 </span><span class="title-name">Fencing and STONITH</span></span> <a title="Permalink" class="permalink" href="cha-ha-fencing.html#">#</a></h1><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sleha/edit/maintenance/SLEHA12SP4/xml/ha_fencing.xml" title="Edit source document"> </a></div></div></div><div><div class="abstract"><p>
    Fencing is a very important concept in computer clusters for HA (High
    Availability). A cluster sometimes detects that one of the nodes is
    behaving strangely and needs to remove it. This is called
    <span class="emphasis"><em>fencing</em></span> and is commonly done with a STONITH
    resource. Fencing may be defined as a method to bring an HA cluster to a
    known state.
   </p><p>
    Every resource in a cluster has a state attached. For example:
    <span class="quote">“<span class="quote">resource r1 is started on alice</span>”</span>. In an HA cluster, such
    a state implies that <span class="quote">“<span class="quote">resource r1 is stopped on all nodes except
    alice</span>”</span>, because the cluster must make sure that every resource
    may be started on only one node. Every node must report every change
    that happens to a resource. The cluster state is thus a collection of
    resource states and node states.
   </p><p>
    When the state of a node or resource cannot be established with
    certainty, fencing comes in. Even when the cluster is not aware of what
    is happening on a given node, fencing can ensure that the node does not
    run any important resources.
   </p></div></div></div></div><section class="sect1" id="sec-ha-fencing-classes" data-id-title="Classes of Fencing"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">9.1 </span><span class="title-name">Classes of Fencing</span></span> <a title="Permalink" class="permalink" href="cha-ha-fencing.html#sec-ha-fencing-classes">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sleha/edit/maintenance/SLEHA12SP4/xml/ha_fencing.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   There are two classes of fencing: resource level and node level fencing.
   The latter is the primary subject of this chapter.
  </p><div class="variablelist"><dl class="variablelist"><dt id="id-1.3.4.7.3.3.1"><span class="term">Resource Level Fencing</span></dt><dd><p>Resource level fencing ensures exclusive access to a given resource.
      Common examples of this are changing the zoning of the node from a SAN fiber
      channel switch (thus locking the node out of access to its disks) or methods
      like SCSI reserve. For examples, refer to <a class="xref" href="cha-ha-storage-protect.html#sec-ha-storage-protect-rsc-fencing" title="10.10. Additional Mechanisms for Storage Protection">Section 10.10, “Additional Mechanisms for Storage Protection”</a>.
     </p></dd><dt id="id-1.3.4.7.3.3.2"><span class="term">Node Level Fencing</span></dt><dd><p>
      Node level fencing prevents a failed node from accessing shared resources
      entirely. This is usually done in a simple and abrupt way: reset or power
      off the node.
     </p></dd></dl></div></section><section class="sect1" id="sec-ha-fencing-nodes" data-id-title="Node Level Fencing"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">9.2 </span><span class="title-name">Node Level Fencing</span></span> <a title="Permalink" class="permalink" href="cha-ha-fencing.html#sec-ha-fencing-nodes">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sleha/edit/maintenance/SLEHA12SP4/xml/ha_fencing.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   In a Pacemaker cluster, the implementation of node level fencing is STONITH
   (Shoot The Other Node in the Head). SUSE Linux Enterprise High Availability
   includes the <code class="command">stonith</code> command line tool, an extensible
   interface for remotely powering down a node in the cluster. For an
   overview of the available options, run <code class="command">stonith --help</code>
   or refer to the man page of <code class="command">stonith</code> for more
   information.
  </p><section class="sect2" id="sec-ha-fencing-nodes-devices" data-id-title="STONITH Devices"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">9.2.1 </span><span class="title-name">STONITH Devices</span></span> <a title="Permalink" class="permalink" href="cha-ha-fencing.html#sec-ha-fencing-nodes-devices">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sleha/edit/maintenance/SLEHA12SP4/xml/ha_fencing.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    To use node level fencing, you first need to have a fencing device. To
    get a list of STONITH devices which are supported by SUSE Linux Enterprise High Availability, run
    one of the following commands on any of the nodes:
   </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt root"># </code>stonith -L</pre></div><p>
    or
   </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt root"># </code>crm ra list stonith</pre></div><p>
    STONITH devices may be classified into the following categories:
   </p><div class="variablelist"><dl class="variablelist"><dt id="id-1.3.4.7.4.3.7.1"><span class="term">Power Distribution Units (PDU)</span></dt><dd><p>
       Power Distribution Units are an essential element in managing power
       capacity and functionality for critical network, server and data
       center equipment. They can provide remote load monitoring of
       connected equipment and individual outlet power control for remote
       power recycling.
      </p></dd><dt id="id-1.3.4.7.4.3.7.2"><span class="term">Uninterruptible Power Supplies (UPS)</span></dt><dd><p>
       A stable power supply provides emergency power to connected equipment
       by supplying power from a separate source if a utility
       power failure occurs.
      </p></dd><dt id="id-1.3.4.7.4.3.7.3"><span class="term">Blade Power Control Devices</span></dt><dd><p>
       If you are running a cluster on a set of blades, then the power
       control device in the blade enclosure is the only candidate for
       fencing. Of course, this device must be capable of managing single
       blade computers.
      </p></dd><dt id="id-1.3.4.7.4.3.7.4"><span class="term">Lights-out Devices </span></dt><dd><p>
       Lights-out devices (IBM RSA, HP iLO, Dell DRAC) are becoming
       increasingly popular and may even become standard in off-the-shelf
       computers. However, if they share a power supply with their host (a
       cluster node), they might not work when needed. If a node stays without
       power, the device supposed to control it would be useless. Therefore, it
       is highly recommended to use battery backed lights-out devices.
       Another aspect is that these devices are accessed by network. This might
       imply a single point of failure, or security concerns.
      </p></dd><dt id="id-1.3.4.7.4.3.7.5"><span class="term">Testing Devices</span></dt><dd><p>
       Testing devices are used exclusively for testing purposes. They are
       usually more gentle on the hardware. Before the cluster goes into
       production, they must be replaced with real fencing devices.
      </p></dd></dl></div><p>
    The choice of the STONITH device depends mainly on your budget and the
    kind of hardware you use.
   </p></section><section class="sect2" id="sec-ha-fencing-nodes-implementation" data-id-title="STONITH Implementation"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">9.2.2 </span><span class="title-name">STONITH Implementation</span></span> <a title="Permalink" class="permalink" href="cha-ha-fencing.html#sec-ha-fencing-nodes-implementation">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sleha/edit/maintenance/SLEHA12SP4/xml/ha_fencing.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    The STONITH implementation of SUSE® Linux Enterprise High Availability consists of two
    components:
   </p><div class="variablelist"><dl class="variablelist"><dt id="id-1.3.4.7.4.4.3.1"><span class="term">stonithd</span></dt><dd><p>
       stonithd is a daemon which can be accessed by local processes or over
       the network. It accepts the commands which correspond to fencing
       operations: reset, power-off, and power-on. It can also check the
       status of the fencing device.
      </p><p>
       The stonithd daemon runs on every node in the CRM HA cluster. The
       stonithd instance running on the DC node receives a fencing request
       from the CRM. It is up to this and other stonithd programs to carry
       out the desired fencing operation.
      </p></dd><dt id="id-1.3.4.7.4.4.3.2"><span class="term">STONITH Plug-ins</span></dt><dd><p>
       For every supported fencing device there is a STONITH plug-in which
       is capable of controlling said device. A STONITH plug-in is the
       interface to the fencing device. The STONITH plug-ins contained in
       the <code class="systemitem">cluster-glue</code> package reside in
       <code class="filename">/usr/lib64/stonith/plugins</code> on each node.
       (If you installed the
       <code class="systemitem"> fence-agents</code> package, too,
       the plug-ins contained there are installed in
       <code class="filename">/usr/sbin/fence_*</code>.) All STONITH plug-ins look
       the same to stonithd, but are quite different on the other side
       reflecting the nature of the fencing device.
      </p><p>
       Some plug-ins support more than one device. A typical example is
       <code class="literal">ipmilan</code> (or <code class="literal">external/ipmi</code>)
       which implements the IPMI protocol and can control any device which
       supports this protocol.
      </p></dd></dl></div></section></section><section class="sect1" id="sec-ha-fencing-config" data-id-title="STONITH Resources and Configuration"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">9.3 </span><span class="title-name">STONITH Resources and Configuration</span></span> <a title="Permalink" class="permalink" href="cha-ha-fencing.html#sec-ha-fencing-config">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sleha/edit/maintenance/SLEHA12SP4/xml/ha_fencing.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   To set up fencing, you need to configure one or more STONITH
   resources—the stonithd daemon requires no configuration. All
   configuration is stored in the CIB. A STONITH resource is a resource of
   class <code class="literal">stonith</code> (see
   <a class="xref" href="cha-ha-config-basics.html#sec-ha-config-basics-raclasses" title="5.3.2. Supported Resource Agent Classes">Section 5.3.2, “Supported Resource Agent Classes”</a>). STONITH resources
   are a representation of STONITH plug-ins in the CIB. Apart from the
   fencing operations, the STONITH resources can be started, stopped and
   monitored, like any other resource. Starting or stopping STONITH
   resources means loading and unloading the STONITH device driver on a
   node. Starting and stopping are thus only administrative operations and
   do not translate to any operation on the fencing device itself. However,
   monitoring does translate to logging it to the device (to verify that the
   device will work in case it is needed). When a STONITH resource fails
   over to another node it enables the current node to talk to the STONITH
   device by loading the respective driver.
  </p><p>
   STONITH resources can be configured like any other resource. For
   details how to do so with your preferred cluster management tool:
  </p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>
     Hawk2: <a class="xref" href="cha-conf-hawk2.html#sec-conf-hawk2-rsc-stonith" title="6.5.6. Adding STONITH Resources">Section 6.5.6, “Adding STONITH Resources”</a>
    </p></li><li class="listitem"><p>
     crmsh: <a class="xref" href="cha-ha-manual-config.html#sec-ha-manual-create-stonith" title="7.4.4. Creating a STONITH Resource">Section 7.4.4, “Creating a STONITH Resource”</a>
    </p></li></ul></div><p>
   The list of parameters (attributes) depends on the respective STONITH
   type. To view a list of parameters for a specific device, use the
   <code class="command">stonith</code> command:
  </p><div class="verbatim-wrap"><pre class="screen">stonith -t <em class="replaceable">stonith-device-type</em> -n</pre></div><p>
   For example, to view the parameters for the <code class="literal">ibmhmc</code>
   device type, enter the following:
  </p><div class="verbatim-wrap"><pre class="screen">stonith -t ibmhmc -n</pre></div><p>
   To get a short help text for the device, use the <code class="option">-h</code>
   option:
  </p><div class="verbatim-wrap"><pre class="screen">stonith -t <em class="replaceable">stonith-device-type</em> -h</pre></div><section class="sect2" id="sec-ha-fencing-config-examples" data-id-title="Example STONITH Resource Configurations"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">9.3.1 </span><span class="title-name">Example STONITH Resource Configurations</span></span> <a title="Permalink" class="permalink" href="cha-ha-fencing.html#sec-ha-fencing-config-examples">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sleha/edit/maintenance/SLEHA12SP4/xml/ha_fencing.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    In the following, find some example configurations written in the syntax
    of the <code class="command">crm</code> command line tool. To apply them, put the
    sample in a text file (for example, <code class="filename">sample.txt</code>) and
    run:
   </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt root"># </code><code class="command">crm</code> &lt; sample.txt</pre></div><p>
    For more information about configuring resources with the
    <code class="command">crm</code> command line tool, refer to
    <a class="xref" href="cha-ha-manual-config.html" title="Chapter 7. Configuring and Managing Cluster Resources (Command Line)">Chapter 7, <em>Configuring and Managing Cluster Resources (Command Line)</em></a>.
   </p><div class="complex-example"><div class="example" id="id-1.3.4.7.5.11.5" data-id-title="Configuration of an IBM RSA Lights-out Device"><div class="title-container"><div class="example-title-wrap"><div class="example-title"><span class="title-number-name"><span class="title-number">Example 9.1: </span><span class="title-name">Configuration of an IBM RSA Lights-out Device </span></span><a title="Permalink" class="permalink" href="cha-ha-fencing.html#id-1.3.4.7.5.11.5">#</a></div></div><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sleha/edit/maintenance/SLEHA12SP4/xml/ha_fencing.xml" title="Edit source document"> </a></div></div><div class="example-contents"><p>
     An IBM RSA lights-out device might be configured like this:
    </p><div class="verbatim-wrap"><pre class="screen">configure
primitive st-ibmrsa-1 stonith:external/ibmrsa-telnet \
params nodename=alice ip_address=192.168.0.101 \
username=USERNAME password=PASSW0RD
primitive st-ibmrsa-2 stonith:external/ibmrsa-telnet \
params nodename=bob ip_address=192.168.0.102 \
username=USERNAME password=PASSW0RD
location l-st-alice st-ibmrsa-1 -inf: alice
location l-st-bob st-ibmrsa-2 -inf: bob
commit</pre></div><p>
     In this example, location constraints are used for the following
     reason: There is always a certain probability that the STONITH
     operation is going to fail. Therefore, a STONITH operation on the
     node which is the executioner as well is not reliable. If the node is
     reset, it cannot send the notification about the fencing operation
     outcome. The only way to do that is to assume that the operation is
     going to succeed and send the notification beforehand. But if the
     operation fails, problems could arise. Therefore, by convention,
     stonithd refuses to terminate its host.
    </p></div></div></div><div class="complex-example"><div class="example" id="id-1.3.4.7.5.11.6" data-id-title="Configuration of a UPS Fencing Device"><div class="title-container"><div class="example-title-wrap"><div class="example-title"><span class="title-number-name"><span class="title-number">Example 9.2: </span><span class="title-name">Configuration of a UPS Fencing Device </span></span><a title="Permalink" class="permalink" href="cha-ha-fencing.html#id-1.3.4.7.5.11.6">#</a></div></div><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sleha/edit/maintenance/SLEHA12SP4/xml/ha_fencing.xml" title="Edit source document"> </a></div></div><div class="example-contents"><p>
     The configuration of a UPS type fencing device is similar to the
     examples above. The details are not covered here. All UPS devices
     employ the same mechanics for fencing. How the device is accessed
     varies. Old UPS devices only had a serial port, usually connected at
     1200baud using a special serial cable. Many new ones still have a
     serial port, but often they also use a USB or Ethernet interface. The
     kind of connection you can use depends on what the plug-in supports.
    </p><p>
     For example, compare the <code class="literal">apcmaster</code> with the
     <code class="literal">apcsmart</code> device by using the <code class="command">stonith
     -t</code> <em class="replaceable">stonith-device-type</em> -n command:
    </p><div class="verbatim-wrap"><pre class="screen">stonith -t apcmaster -h</pre></div><p>
     returns the following information:
    </p><div class="verbatim-wrap"><pre class="screen">STONITH Device: apcmaster - APC MasterSwitch (via telnet)
NOTE: The APC MasterSwitch accepts only one (telnet)
connection/session a time. When one session is active,
subsequent attempts to connect to the MasterSwitch will fail.
For more information see http://www.apc.com/
List of valid parameter names for apcmaster STONITH device:
ipaddr
login
 password</pre></div><p>
     With
    </p><div class="verbatim-wrap"><pre class="screen">stonith -t apcsmart -h</pre></div><p>
     you get the following output:
    </p><div class="verbatim-wrap"><pre class="screen">STONITH Device: apcsmart - APC Smart UPS
(via serial port - NOT USB!).
Works with higher-end APC UPSes, like
Back-UPS Pro, Smart-UPS, Matrix-UPS, etc.
(Smart-UPS may have to be &gt;= Smart-UPS 700?).
See http://www.networkupstools.org/protocols/apcsmart.html
for protocol compatibility details.
For more information see http://www.apc.com/
List of valid parameter names for apcsmart STONITH device:
ttydev
hostlist</pre></div><p>
     The first plug-in supports APC UPS with a network port and telnet
     protocol. The second plug-in uses the APC SMART protocol over the
     serial line, which is supported by many APC UPS product
     lines.
    </p></div></div></div><div class="complex-example"><div class="example" id="ex-ha-fencing-kdump" data-id-title="Configuration of a Kdump Device"><div class="title-container"><div class="example-title-wrap"><div class="example-title"><span class="title-number-name"><span class="title-number">Example 9.3: </span><span class="title-name">Configuration of a Kdump Device </span></span><a title="Permalink" class="permalink" href="cha-ha-fencing.html#ex-ha-fencing-kdump">#</a></div></div><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sleha/edit/maintenance/SLEHA12SP4/xml/ha_fencing.xml" title="Edit source document"> </a></div></div><div class="example-contents"><p>Kdump belongs to the <a class="xref" href="cha-ha-fencing.html#sec-ha-fencing-special" title="9.5. Special Fencing Devices">Special Fencing Devices</a> and is in fact the opposite of a fencing device.
     The plug-in checks if a Kernel dump is in progress on a node. If so, it
     returns true, and acts <span class="emphasis"><em>as if</em></span> the node has been fenced.
    </p><p>
     The Kdump plug-in must be used in concert with another, real STONITH
     device, for example, <code class="literal">external/ipmi</code>. For the fencing
     mechanism to work properly, you must specify that Kdump is checked before
     a real STONITH device is triggered. Use <code class="command">crm configure
     fencing_topology</code> to specify the order of the fencing devices as
     shown in the following procedure.
   </p><div class="procedure"><div class="procedure-contents"><ol class="procedure" type="1"><li class="step"><p>
     Use the <code class="literal">stonith:fence_kdump</code> resource agent (provided
     by the package <code class="systemitem">fence-agents</code>)
     to monitor all nodes with the Kdump function enabled. Find a
     configuration example for the resource below:
    </p><div class="verbatim-wrap"><pre class="screen">configure
  primitive st-kdump stonith:fence_kdump \
    params nodename="alice "\ <span class="callout" id="co-ha-fenc-kdump-nodename">1</span>
    pcmk_host_check="static-list" \
    pcmk_reboot_action="off" \
    pcmk_monitor_action="metadata" \
    pcmk_reboot_retries="1" \
    timeout="60"
commit</pre></div><div class="calloutlist"><table style="border: 0; "><tr><td style="width: 5%; vertical-align: top; text-align: left; "><p><a href="#co-ha-fenc-kdump-nodename"><span class="callout">1</span></a> </p></td><td style="vertical-align: top; text-align: left; "><p>
       Name of the node to be monitored. If you need to monitor more than one
       node, configure more STONITH resources. To prevent a specific node
       from using a fencing device, add location constraints.
      </p></td></tr></table></div><p>
     The fencing action will be started after the timeout of the resource.
    </p></li><li class="step"><p>
     In <code class="filename">/etc/sysconfig/kdump</code> on each node, configure
     <code class="literal">KDUMP_POSTSCRIPT</code> to send a notification to all nodes
     when the Kdump process is finished. For example:
    </p><div class="verbatim-wrap"><pre class="screen">/usr/lib/fence_kdump_send -i <em class="replaceable">INTERVAL</em> -p <em class="replaceable">PORT</em> -c 1 alice bob charlie [...]</pre></div><p>
     The node that does a Kdump will restart automatically after Kdump has
     finished.
    </p></li><li class="step"><p>
     Write a new <code class="filename">initrd</code> to include the library <code class="literal">fence_kdump_send</code>
     with network enabled. Use the <code class="option">-f</code> option to overwrite
     the existing file, so the new file will be used for the next boot process:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt root"># </code>dracut -f -a kdump</pre></div></li><li class="step"><p>
     Open a port in the firewall for the <code class="literal">fence_kdump</code> resource.
     The default port is <code class="literal">7410</code>.
    </p></li><li class="step"><p>
     To have Kdump checked before triggering a real fencing
     mechanism (like <code class="literal">external/ipmi</code>),
     use a configuration similar to the following:</p><div class="verbatim-wrap"><pre class="screen">fencing_topology \
  alice: kdump-node1 ipmi-node1 \
  bob: kdump-node2 ipmi-node2</pre></div><p>For more details on <code class="option">fencing_topology</code>:
    </p><div class="verbatim-wrap"><pre class="screen">crm configure help fencing_topology</pre></div></li></ol></div></div></div></div></div></section></section><section class="sect1" id="sec-ha-fencing-monitor" data-id-title="Monitoring Fencing Devices"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">9.4 </span><span class="title-name">Monitoring Fencing Devices</span></span> <a title="Permalink" class="permalink" href="cha-ha-fencing.html#sec-ha-fencing-monitor">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sleha/edit/maintenance/SLEHA12SP4/xml/ha_fencing.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   Like any other resource, the STONITH class agents also support the
   monitoring operation for checking status.
  </p><div id="id-1.3.4.7.6.3" data-id-title="Monitoring STONITH Resources" class="admonition note normal"><img class="symbol" alt="Note" title="Note" src="static/images/icon-note.svg"/><div class="admon-title">Note: Monitoring STONITH Resources</div><p>
    Monitor STONITH resources regularly, yet sparingly. For most devices a
    monitoring interval of at least 1800 seconds (30 minutes) should
    suffice.
   </p></div><p>
   Fencing devices are an indispensable part of an HA cluster, but the less
   you need to use them, the better. Power management equipment is often
   affected by too much broadcast traffic. Some devices cannot handle more
   than ten or so connections per minute. Some get confused if two clients
   try to connect at the same time. Most cannot handle more than one session
   at a time.
  </p><p>
   Checking the status of fencing devices once every few hours should
   usually be enough. The probability that a fencing operation needs to be
   performed and the power switch fails is low.
  </p><p>
   For detailed information on how to configure monitor operations, refer to

   <a class="xref" href="cha-ha-manual-config.html#sec-ha-manual-config-monitor" title="7.4.9. Configuring Resource Monitoring">Section 7.4.9, “Configuring Resource Monitoring”</a> for the command line
   approach.
  </p></section><section class="sect1" id="sec-ha-fencing-special" data-id-title="Special Fencing Devices"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">9.5 </span><span class="title-name">Special Fencing Devices</span></span> <a title="Permalink" class="permalink" href="cha-ha-fencing.html#sec-ha-fencing-special">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sleha/edit/maintenance/SLEHA12SP4/xml/ha_fencing.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   In addition to plug-ins which handle real STONITH devices, there are
   special purpose STONITH plug-ins.
  </p><div id="id-1.3.4.7.7.3" data-id-title="For Testing Only" class="admonition warning normal"><img class="symbol" alt="Warning" title="Warning" src="static/images/icon-warning.svg"/><div class="admon-title">Warning: For Testing Only</div><p>
    Some STONITH plug-ins mentioned below are for demonstration and
    testing purposes only. Do not use any of the following devices in
    real-life scenarios because this may lead to data corruption and
    unpredictable results:
   </p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>
      <code class="literal">external/ssh </code>
     </p></li><li class="listitem"><p>
      <code class="literal">ssh </code>
     </p></li></ul></div></div><div class="variablelist"><dl class="variablelist"><dt id="vle-fence-kdump"><span class="term"><code class="literal">fence_kdump</code>
    </span></dt><dd><p>
      This plug-in checks if a Kernel dump is in progress on a node. If so,
      it returns <code class="literal">true</code>, and acts as if the node has been
      fenced. The node cannot run any resources during the dump anyway. This
      avoids fencing a node that is already down but doing a dump, which
      takes some time. The plug-in must be used in concert with another,
      real STONITH device.
     </p><p>
      For configuration details, see <a class="xref" href="cha-ha-fencing.html#ex-ha-fencing-kdump" title="Configuration of a Kdump Device">Example 9.3, “Configuration of a Kdump Device”</a>.
     </p></dd><dt id="id-1.3.4.7.7.4.2"><span class="term"><code class="literal">external/sbd</code>
    </span></dt><dd><p>
      This is a self-fencing device. It reacts to a so-called <span class="quote">“<span class="quote">poison
      pill</span>”</span> which can be inserted into a shared disk. On
      shared-storage connection loss, it stops the node from operating.
      Learn how to use this STONITH agent to implement storage-based
      fencing in
      <a class="xref" href="cha-ha-storage-protect.html" title="Chapter 10. Storage Protection and SBD">Chapter 10</a>,
      <a class="xref" href="cha-ha-storage-protect.html#pro-ha-storage-protect-fencing" title="Configuring the Cluster to Use SBD">Procedure 10.7, “Configuring the Cluster to Use SBD”</a>. See also
      <a class="link" href="https://github.com/ClusterLabs/sbd" target="_blank">https://github.com/ClusterLabs/sbd</a>
      for more details.
     </p><div id="id-1.3.4.7.7.4.2.2.2" data-id-title="external/sbd and DRBD" class="admonition important normal"><img class="symbol" alt="Important" title="Important" src="static/images/icon-important.svg"/><div class="admon-title">Important: <code class="literal">external/sbd</code> and DRBD</div><p>
       The <code class="literal">external/sbd</code> fencing mechanism requires that
       the SBD partition is readable directly from each node. Thus, a DRBD*
       device must not be used for an SBD partition.
      </p><p>
       However, you can use the fencing mechanism for a DRBD cluster,
       provided the SBD partition is located on a shared disk that is not
       mirrored or replicated.
      </p></div></dd><dt id="id-1.3.4.7.7.4.3"><span class="term"><code class="literal">external/ssh</code>
    </span></dt><dd><p>
      Another software-based <span class="quote">“<span class="quote">fencing</span>”</span> mechanism. The nodes
      must be able to log in to each other as <code class="systemitem">root</code> without passwords.
      It takes a single parameter, <code class="literal">hostlist</code>, specifying
      the nodes that it will target. As it is not able to reset a truly
      failed node, it must not be used for real-life clusters—for
      testing and demonstration purposes only. Using it for shared storage
      would result in data corruption.
     </p></dd><dt id="id-1.3.4.7.7.4.4"><span class="term"><code class="literal">meatware</code>
    </span></dt><dd><p>
      <code class="literal">meatware</code> requires help from the user to operate.
      Whenever invoked, <code class="literal">meatware</code> logs a CRIT severity
      message which shows up on the node's console. The operator then
      confirms that the node is down and issues a
      <code class="command">meatclient(8)</code> command. This tells
      <code class="literal">meatware</code> to inform the cluster that the node should
      be considered dead. See
      <code class="filename">/usr/share/doc/packages/cluster-glue/README.meatware</code>
      for more information.
     </p></dd><dt id="id-1.3.4.7.7.4.5"><span class="term"><code class="literal">suicide</code>
    </span></dt><dd><p>
      This is a software-only device, which can reboot a node it is running
      on, using the <code class="command">reboot</code> command. This requires action
      by the node's operating system and can fail under certain
      circumstances. Therefore avoid using this device whenever possible.
      However, it is safe to use on one-node clusters.
     </p></dd><dt id="id-1.3.4.7.7.4.6"><span class="term">Diskless SBD</span></dt><dd><p>This configuration is useful if you want a fencing mechanism without
     shared storage. In this diskless mode, SBD fences nodes by using the
     hardware watchdog without relying on any shared device.
     However, diskless SBD cannot handle a split brain scenario for
     a two-node cluster. Therefore, three or more nodes are required for
     using diskless SBD.</p></dd></dl></div><p>
   <code class="literal">suicide</code>

   is the only exception to the <span class="quote">“<span class="quote">I do not shoot my host</span>”</span> rule.
  </p></section><section class="sect1" id="sec-ha-fencing-recommend" data-id-title="Basic Recommendations"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">9.6 </span><span class="title-name">Basic Recommendations</span></span> <a title="Permalink" class="permalink" href="cha-ha-fencing.html#sec-ha-fencing-recommend">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sleha/edit/maintenance/SLEHA12SP4/xml/ha_fencing.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   Check the following list of recommendations to avoid common mistakes:
  </p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>
     Do not configure several power switches in parallel.
    </p></li><li class="listitem"><p>
     To test your STONITH devices and their configuration, pull the plug
     once from each node and verify that fencing the node does takes place.
    </p></li><li class="listitem"><p>
     Test your resources under load and verify the timeout values are
     appropriate. Setting timeout values too low can trigger (unnecessary)
     fencing operations. For details, refer to
     <a class="xref" href="cha-ha-config-basics.html#sec-ha-config-basics-timeouts" title="5.3.9. Timeout Values">Section 5.3.9, “Timeout Values”</a>.
    </p></li><li class="listitem"><p>
     Use appropriate fencing devices for your setup. For details, also refer
     to <a class="xref" href="cha-ha-fencing.html#sec-ha-fencing-special" title="9.5. Special Fencing Devices">Section 9.5, “Special Fencing Devices”</a>.
    </p></li><li class="listitem"><p>
     Configure one or more STONITH resources. By default, the global
     cluster option <code class="literal">stonith-enabled</code> is set to
     <code class="literal">true</code>. If no STONITH resources have been defined,
     the cluster will refuse to start any resources.
    </p></li><li class="listitem"><p>
     Do not set the global cluster option
     <code class="systemitem">stonith-enabled</code> to <code class="literal">false</code>
     for the following reasons:
    </p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>
       Clusters without STONITH enabled are not supported.
      </p></li><li class="listitem"><p>
       DLM/OCFS2 will block forever waiting for a fencing operation that
       will never happen.
      </p></li></ul></div></li><li class="listitem"><p>
     Do not set the global cluster option
     <code class="systemitem">startup-fencing</code> to <code class="literal">false</code>.
     By default, it is set to <code class="literal">true</code> for the following
     reason: If a node is in an unknown state during cluster start-up, the
     node will be fenced once to clarify its status.
    </p></li></ul></div></section><section class="sect1" id="sec-ha-fencing-more" data-id-title="For More Information"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">9.7 </span><span class="title-name">For More Information</span></span> <a title="Permalink" class="permalink" href="cha-ha-fencing.html#sec-ha-fencing-more">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sleha/edit/maintenance/SLEHA12SP4/xml/ha_fencing.xml" title="Edit source document"> </a></div></div></div></div></div><div class="variablelist"><dl class="variablelist"><dt id="id-1.3.4.7.9.2.1"><span class="term"><code class="filename">/usr/share/doc/packages/cluster-glue</code>
    </span></dt><dd><p>
      In your installed system, this directory contains README files for
      many STONITH plug-ins and devices.
     </p></dd><dt id="id-1.3.4.7.9.2.2"><span class="term"><a class="link" href="http://www.clusterlabs.org/pacemaker/doc/" target="_blank">http://www.clusterlabs.org/pacemaker/doc/</a>
    </span></dt><dd><p>
       <em class="citetitle">Pacemaker Explained</em>: Explains the concepts used to configure Pacemaker.
      Contains comprehensive and detailed information for reference.
     </p></dd><dt id="id-1.3.4.7.9.2.3"><span class="term"><a class="link" href="http://techthoughts.typepad.com/managing_computers/2007/10/split-brain-quo.html" target="_blank">http://techthoughts.typepad.com/managing_computers/2007/10/split-brain-quo.html</a>
    </span></dt><dd><p>
      Article explaining the concepts of split brain, quorum and fencing in
      HA clusters.
     </p></dd></dl></div></section></section><nav class="bottom-pagination"><div><a class="pagination-link prev" href="cha-ha-agents.html"><span class="pagination-relation">Previous</span><span class="pagination-label"><span class="title-number">Chapter 8 </span>Adding or Modifying Resource Agents</span></a> </div><div><a class="pagination-link next" href="cha-ha-storage-protect.html"><span class="pagination-relation">Next</span><span class="pagination-label"><span class="title-number">Chapter 10 </span>Storage Protection and SBD</span></a> </div></nav></article><aside id="_side-toc-page" class="side-toc"><div class="side-title">On this page</div><div class="toc"><ul><li><span class="sect1"><a href="cha-ha-fencing.html#sec-ha-fencing-classes"><span class="title-number">9.1 </span><span class="title-name">Classes of Fencing</span></a></span></li><li><span class="sect1"><a href="cha-ha-fencing.html#sec-ha-fencing-nodes"><span class="title-number">9.2 </span><span class="title-name">Node Level Fencing</span></a></span></li><li><span class="sect1"><a href="cha-ha-fencing.html#sec-ha-fencing-config"><span class="title-number">9.3 </span><span class="title-name">STONITH Resources and Configuration</span></a></span></li><li><span class="sect1"><a href="cha-ha-fencing.html#sec-ha-fencing-monitor"><span class="title-number">9.4 </span><span class="title-name">Monitoring Fencing Devices</span></a></span></li><li><span class="sect1"><a href="cha-ha-fencing.html#sec-ha-fencing-special"><span class="title-number">9.5 </span><span class="title-name">Special Fencing Devices</span></a></span></li><li><span class="sect1"><a href="cha-ha-fencing.html#sec-ha-fencing-recommend"><span class="title-number">9.6 </span><span class="title-name">Basic Recommendations</span></a></span></li><li><span class="sect1"><a href="cha-ha-fencing.html#sec-ha-fencing-more"><span class="title-number">9.7 </span><span class="title-name">For More Information</span></a></span></li></ul></div><div class="side-title">Share this page</div><ul class="share"><li><a id="_share-fb" href="#" title="Facebook"> </a></li><li><a id="_share-in" href="#" title="LinkedIn"> </a></li><li><a id="_share-tw" href="#" title="Twitter/X"> </a></li><li><a id="_share-mail" href="#" title="E-Mail"> </a></li><li><a id="_print-button" href="#" title="Print this page"> </a></li></ul> </aside></main><footer id="_footer"><div class="growth-inhibitor"><div class="copy"><span class="copy__rights">© SUSE
                 2023</span></div></div></footer></body></html>
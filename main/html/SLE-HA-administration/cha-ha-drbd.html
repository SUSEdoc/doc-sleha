<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><title>SLE HA 15 SP6 | Administration Guide | DRBD</title><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes"/><link rel="stylesheet" type="text/css" href="static/css/style.css"/>
<link rel="schema.DC" href="http://purl.org/dc/elements/1.1/"/><link rel="schema.DCTERMS" href="http://purl.org/dc/terms/"/>
<meta name="title" content="DRBD | SLE HA 15 SP6"/>
<meta name="description" content="The distributed replicated block device (DRBD*) allows you to create a mirror of two block devices that are located at two different sites across an …"/>
<meta name="product-name" content="SUSE Linux Enterprise High Availability"/>
<meta name="product-number" content="15 SP6"/>
<meta name="book-title" content="Administration Guide"/>
<meta name="chapter-title" content="Chapter 23. DRBD"/>
<meta name="tracker-url" content="https://bugzilla.suse.com/enter_bug.cgi"/>
<meta name="tracker-type" content="bsc"/>
<meta name="tracker-bsc-component" content="Documentation"/>
<meta name="tracker-bsc-product" content="PUBLIC SUSE Linux Enterprise High Availability Extension 15 SP6"/>
<meta name="publisher" content="SUSE"/><meta property="og:title" content="DRBD | SLE HA 15 SP6"/>
<meta property="og:description" content="The distributed replicated block device (DRBD*) allows you …"/>
<meta property="og:type" content="article"/>
<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="DRBD | SLE HA 15 SP6"/>
<meta name="twitter:description" content="The distributed replicated block device (DRBD*) allows you …"/>
<link rel="prev" href="cha-ha-gfs2.html" title="Chapter 22. GFS2"/><link rel="next" href="cha-ha-clvm.html" title="Chapter 24. Cluster logical volume manager (Cluster LVM)"/><script type="text/javascript">

if ( window.location.protocol.toLowerCase() != 'file:' ) {
  document.write('<link rel="stylesheet" type="text/css" href="https://documentation.suse.com/docserv/res/fonts/poppins/poppins.css"></link>');
};

</script><noscript><link rel="stylesheet" type="text/css" href="https://documentation.suse.com/docserv/res/fonts/poppins/poppins.css"/></noscript><script src="static/js/script-purejs.js" type="text/javascript"> </script><script src="static/js/highlight.min.js" type="text/javascript"> </script><script>

$(document).ready(function() {
  $('.verbatim-wrap.highlight').each(function(i, block) {
    hljs.highlightBlock(block);
  });
});
hljs.configure({
  useBR: false
});

</script><meta name="edit-url" content="https://github.com/SUSE/doc-sleha/edit/main/xml/ha_drbd.xml"/></head><body class="draft wide offline js-off" onload="$('#betawarn-button-wrap').toggle();if (document.cookie.length > 0) {if (document.cookie.indexOf('betawarn=closed') != -1){$('#betawarn').toggle()}};"><div id="betawarn" style="position:fixed;bottom:0;z-index:9025;background-color:#FDE8E8;padding:1em;margin-left:10%;margin-right:10%;display:block;border-top:.75em solid #E11;width:80%"><p style="color:#333;margin:1em 0;padding:0;">This is a draft document that was built and uploaded automatically. It may document beta software and be incomplete or even incorrect. <strong>Use this document at your own risk.</strong></p> <div id="betawarn-button-wrap" style="display:none;margin:0;padding:0;"><a href="#" onclick="$('#betawarn').toggle();var d=new Date();d.setTime(d.getTime()+(0.5*24*60*60*1000));document.cookie='betawarn=closed; expires='+d.toUTCString()+'; path=/'; return false;" style="color:#333;text-decoration:underline;float:left;margin-top:.5em;padding:1em;display:block;background-color:#FABEBE;">I understand this is a draft</a></div></div><div class="bypass-block"><a href="#_content">Jump to content</a><a href="#_bottom-pagination">Jump to page navigation: previous page [access key p]/next page [access key n]</a></div><header id="_mainnav"><div class="growth-inhibitor"><img src="static/images/logo.svg" alt="Logo" class="logo"/></div></header><div class="crumbs"><div class="growth-inhibitor"><a class="crumb" href="index.html">Administration Guide</a><span> / </span><a class="crumb" href="part-storage.html">Storage and data replication</a><span> / </span><a class="crumb" href="cha-ha-drbd.html">DRBD</a></div></div><main id="_content"><nav id="_side-toc-overall" class="side-toc"><div class="side-title">Administration Guide</div><ol><li><a href="pre-ha.html" class=" "><span class="title-number"> </span><span class="title-name">Preface</span></a></li><li><a href="part-install.html" class="has-children "><span class="title-number">I </span><span class="title-name">Installation and setup</span></a><ol><li><a href="cha-ha-concepts.html" class=" "><span class="title-number">1 </span><span class="title-name">Product overview</span></a></li><li><a href="cha-ha-requirements.html" class=" "><span class="title-number">2 </span><span class="title-name">System requirements and recommendations</span></a></li><li><a href="cha-ha-install.html" class=" "><span class="title-number">3 </span><span class="title-name">Installing SUSE Linux Enterprise High Availability</span></a></li><li><a href="cha-ha-ycluster.html" class=" "><span class="title-number">4 </span><span class="title-name">Using the YaST cluster module</span></a></li></ol></li><li><a href="part-config.html" class="has-children "><span class="title-number">II </span><span class="title-name">Configuration and administration</span></a><ol><li><a href="cha-ha-config-basics.html" class=" "><span class="title-number">5 </span><span class="title-name">Configuration and administration basics</span></a></li><li><a href="sec-ha-config-basics-resources.html" class=" "><span class="title-number">6 </span><span class="title-name">Configuring cluster resources</span></a></li><li><a href="sec-ha-config-basics-constraints.html" class=" "><span class="title-number">7 </span><span class="title-name">Configuring resource constraints</span></a></li><li><a href="cha-ha-manage-resources.html" class=" "><span class="title-number">8 </span><span class="title-name">Managing cluster resources</span></a></li><li><a href="sec-ha-config-basics-remote.html" class=" "><span class="title-number">9 </span><span class="title-name">Managing services on remote hosts</span></a></li><li><a href="cha-ha-agents.html" class=" "><span class="title-number">10 </span><span class="title-name">Adding or modifying resource agents</span></a></li><li><a href="cha-ha-monitor-clusters.html" class=" "><span class="title-number">11 </span><span class="title-name">Monitoring clusters</span></a></li><li><a href="cha-ha-fencing.html" class=" "><span class="title-number">12 </span><span class="title-name">Fencing and STONITH</span></a></li><li><a href="cha-ha-storage-protect.html" class=" "><span class="title-number">13 </span><span class="title-name">Storage protection and SBD</span></a></li><li><a href="cha-ha-qdevice.html" class=" "><span class="title-number">14 </span><span class="title-name">QDevice and QNetd</span></a></li><li><a href="cha-ha-acl.html" class=" "><span class="title-number">15 </span><span class="title-name">Access control lists</span></a></li><li><a href="cha-ha-netbonding.html" class=" "><span class="title-number">16 </span><span class="title-name">Network device bonding</span></a></li><li><a href="cha-ha-lb.html" class=" "><span class="title-number">17 </span><span class="title-name">Load balancing</span></a></li><li><a href="cha-ha-virtualization.html" class=" "><span class="title-number">18 </span><span class="title-name">High Availability for virtualization</span></a></li><li><a href="cha-ha-geo.html" class=" "><span class="title-number">19 </span><span class="title-name">Geo clusters (multi-site clusters)</span></a></li></ol></li><li class="active"><a href="part-storage.html" class="has-children you-are-here"><span class="title-number">III </span><span class="title-name">Storage and data replication</span></a><ol><li><a href="cha-ha-storage-dlm.html" class=" "><span class="title-number">20 </span><span class="title-name">Distributed Lock Manager (DLM)</span></a></li><li><a href="cha-ha-ocfs2.html" class=" "><span class="title-number">21 </span><span class="title-name">OCFS2</span></a></li><li><a href="cha-ha-gfs2.html" class=" "><span class="title-number">22 </span><span class="title-name">GFS2</span></a></li><li><a href="cha-ha-drbd.html" class=" you-are-here"><span class="title-number">23 </span><span class="title-name">DRBD</span></a></li><li><a href="cha-ha-clvm.html" class=" "><span class="title-number">24 </span><span class="title-name">Cluster logical volume manager (Cluster LVM)</span></a></li><li><a href="cha-ha-cluster-md.html" class=" "><span class="title-number">25 </span><span class="title-name">Cluster multi-device (Cluster MD)</span></a></li><li><a href="cha-ha-samba.html" class=" "><span class="title-number">26 </span><span class="title-name">Samba clustering</span></a></li><li><a href="cha-ha-rear.html" class=" "><span class="title-number">27 </span><span class="title-name">Disaster recovery with ReaR (Relax-and-Recover)</span></a></li></ol></li><li><a href="part-maintenance.html" class="has-children "><span class="title-number">IV </span><span class="title-name">Maintenance and upgrade</span></a><ol><li><a href="cha-ha-maintenance.html" class=" "><span class="title-number">28 </span><span class="title-name">Executing maintenance tasks</span></a></li><li><a href="cha-ha-migration.html" class=" "><span class="title-number">29 </span><span class="title-name">Upgrading your cluster and updating software packages</span></a></li></ol></li><li><a href="part-appendix.html" class="has-children "><span class="title-number">V </span><span class="title-name">Appendix</span></a><ol><li><a href="app-ha-troubleshooting.html" class=" "><span class="title-number">A </span><span class="title-name">Troubleshooting</span></a></li><li><a href="app-naming.html" class=" "><span class="title-number">B </span><span class="title-name">Naming conventions</span></a></li><li><a href="app-ha-management.html" class=" "><span class="title-number">C </span><span class="title-name">Cluster management tools (command line)</span></a></li><li><a href="app-crmreport-nonroot.html" class=" "><span class="title-number">D </span><span class="title-name">Running cluster reports without <code class="systemitem">root</code> access</span></a></li></ol></li><li><a href="gl-heartb.html" class=" "><span class="title-number"> </span><span class="title-name">Glossary</span></a></li><li><a href="bk02ape.html" class=" "><span class="title-number">E </span><span class="title-name">GNU licenses</span></a></li> </ol> </nav><button id="_open-side-toc-overall" title="Contents"> </button><article class="documentation"><button id="_unfold-side-toc-page">On this page</button><section class="chapter" id="cha-ha-drbd" data-id-title="DRBD"><div class="titlepage"><div><div class="version-info">Applies to  <span class="productname">SUSE Linux Enterprise High Availability</span> <span class="productnumber">15 SP6</span></div><div><div class="title-container"><h1 class="title"><span class="title-number-name"><span class="title-number">23 </span><span class="title-name">DRBD</span></span> <a title="Permalink" class="permalink" href="cha-ha-drbd.html#">#</a></h1><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sleha/edit/main/xml/ha_drbd.xml" title="Edit source document"> </a></div></div></div><div><div class="abstract"><p>
    The <span class="emphasis"><em>distributed replicated block device</em></span> (DRBD*)
    allows you to create a mirror of two block devices that are located at
    two different sites across an IP network. When used with Corosync,
    DRBD supports distributed high-availability Linux clusters. This chapter
    shows you how to install and set up DRBD.
   </p></div></div></div></div><section class="sect1" id="sec-ha-drbd-overview" data-id-title="Conceptual overview"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">23.1 </span><span class="title-name">Conceptual overview</span></span> <a title="Permalink" class="permalink" href="cha-ha-drbd.html#sec-ha-drbd-overview">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sleha/edit/main/xml/ha_drbd.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   DRBD replicates data on the primary device to the secondary device in a
   way that ensures that both copies of the data remain identical. Think of
   it as a networked RAID 1. It mirrors data in real-time, so its
   replication occurs continuously. Applications do not need to know that in
   fact their data is stored on different disks.

  </p><p>
   DRBD is a Linux Kernel module and sits between the I/O scheduler at the
   lower end and the file system at the upper end, see
   <a class="xref" href="cha-ha-drbd.html#fig-ha-drbd-concept" title="Position of DRBD within Linux">Figure 23.1, “Position of DRBD within Linux”</a>. To communicate with DRBD, users
   use the high-level command <code class="command">drbdadm</code>. For maximum
   flexibility DRBD comes with the low-level tool
   <code class="command">drbdsetup</code>.
  </p><div class="figure" id="fig-ha-drbd-concept"><div class="figure-contents"><div class="mediaobject"><a href="images/ha_drbd.png"><img src="images/ha_drbd.png" width="80%" alt="Position of DRBD within Linux" title="Position of DRBD within Linux"/></a></div></div><div class="title-container"><div class="figure-title-wrap"><div class="figure-title"><span class="title-number-name"><span class="title-number">Figure 23.1: </span><span class="title-name">Position of DRBD within Linux </span></span><a title="Permalink" class="permalink" href="cha-ha-drbd.html#fig-ha-drbd-concept">#</a></div></div><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sleha/edit/main/xml/ha_drbd.xml" title="Edit source document"> </a></div></div></div><div id="id-1.4.5.6.3.5" data-id-title="Unencrypted data" class="admonition important normal"><img class="symbol" alt="Important" title="Important" src="static/images/icon-important.svg"/><div class="admon-title">Important: Unencrypted data</div><p>
    The data traffic between mirrors is not encrypted. For secure data
    exchange, you should deploy a Virtual Private Network (VPN) solution for
    the connection.
   </p></div><p>
   DRBD allows you to use any block device supported by Linux, usually:
  </p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>
     partition or complete hard disk
    </p></li><li class="listitem"><p>
     software RAID
    </p></li><li class="listitem"><p>
     Logical Volume Manager (LVM)
    </p></li><li class="listitem"><p>
     Enterprise Volume Management System (EVMS)
    </p></li></ul></div><p>
   By default, DRBD uses the TCP ports <code class="literal">7788</code> and higher
   for communication between DRBD nodes. Make sure that your firewall does
   not prevent communication on the used ports.
  </p><p>
   You must set up the DRBD devices before creating file systems on them.
   Everything pertaining to user data should be done solely via the
   <code class="filename">/dev/drbd<em class="replaceable">N</em></code> device and
   not on the raw device, as DRBD uses the last part of the raw device for
   metadata. Using the raw device will cause inconsistent data.
  </p><p>
   With udev integration, you will also get symbolic links in the form
   <code class="filename">/dev/drbd/by-res/<em class="replaceable">RESOURCES</em></code>
   which are easier to use and provide safety against remembering the wrong
   minor number of the device.
  </p><p>
   For example, if the raw device is 1024 MB in size, the DRBD
   device has only 1023 MB available for data, with about
   70 KB hidden and reserved for the metadata. Any attempt to access
   the remaining kilobytes via raw disks fails because
   it is not available for user data.
  </p></section><section class="sect1" id="sec-ha-drbd-install" data-id-title="Installing DRBD services"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">23.2 </span><span class="title-name">Installing DRBD services</span></span> <a title="Permalink" class="permalink" href="cha-ha-drbd.html#sec-ha-drbd-install">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sleha/edit/main/xml/ha_drbd.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   Install the High Availability pattern on both SUSE Linux Enterprise Server machines in your networked
   cluster as described in <a class="xref" href="part-install.html" title="Part I. Installation and setup">Part I, “Installation and setup”</a>. Installing
   the pattern also installs the DRBD program files.
  </p><p>
   If you do not need the complete cluster stack but only want to use DRBD,
   install the packages <span class="package">drbd</span>,
    <span class="package">drbd-kmp-<em class="replaceable">FLAVOR</em></span>,
    <span class="package">drbd-utils</span>, and <span class="package">yast2-drbd</span>.
  </p></section><section class="sect1" id="sec-ha-drbd-configure" data-id-title="Setting up DRBD service"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">23.3 </span><span class="title-name">Setting up DRBD service</span></span> <a title="Permalink" class="permalink" href="cha-ha-drbd.html#sec-ha-drbd-configure">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sleha/edit/main/xml/ha_drbd.xml" title="Edit source document"> </a></div></div></div></div></div><div id="id-1.4.5.6.5.2" data-id-title="Adjustments needed" class="admonition note normal"><img class="symbol" alt="Note" title="Note" src="static/images/icon-note.svg"/><div class="admon-title">Note: Adjustments needed</div><p>
    The following procedure uses the server names alice and bob,
    and the DRBD resource name <code class="literal">r0</code>. It sets up
    alice as the primary node and <code class="filename">/dev/disk/by-id/example-disk1</code> for
    storage. Make sure to modify the instructions to use your own nodes and
    file names.
   </p></div><p>
   The following sections assumes you have two nodes, alice
   and bob, and that they should use the TCP port <code class="literal">7788</code>.
   Make sure this port is open in your firewall.
  </p><div class="procedure"><div class="procedure-contents"><ol class="procedure" type="1"><li class="step"><p>Prepare your system:</p><ol type="a" class="substeps"><li class="step"><p>Make sure the block devices in your Linux nodes are ready
            and partitioned (if needed).</p></li><li class="step"><p>
            If your disk already contains a file system that you do not need
            anymore, destroy the file system structure with the following
            command:
          </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt root"># </code><code class="command">dd if=/dev/zero of=<em class="replaceable">YOUR_DEVICE</em> count=16 bs=1M</code></pre></div><p>If you have more file systems to destroy, repeat this step on
           all devices you want to include into your DRBD setup.</p></li><li class="step"><p>If the cluster is already using DRBD, put your cluster
              in maintenance mode: </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt root"># </code><code class="command">crm configure property maintenance-mode=true</code></pre></div><p> If you skip this step when your cluster already uses
              DRBD, a syntax error in the live configuration will lead
              to a service shutdown. </p><p>As an alternative, you can also use
                <code class="command">drbdadm</code>
              <code class="option">-c <em class="replaceable">FILE</em></code> to
              test a configuration file.</p></li></ol></li><li class="step"><p>Configure DRBD by choosing your method:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p><a class="xref" href="cha-ha-drbd.html#sec-ha-drbd-configure-manually" title="23.3.1. Configuring DRBD manually">Section 23.3.1, “Configuring DRBD manually”</a></p></li><li class="listitem"><p><a class="xref" href="cha-ha-drbd.html#sec-ha-drbd-configure-yast" title="23.3.2. Configuring DRBD with YaST">Section 23.3.2, “Configuring DRBD with YaST”</a></p></li></ul></div></li><li class="step"><p>
        If you have configured Csync2 (which should be the default), the
        DRBD configuration files are already included in the list of files that
        need to be synchronized. To synchronize them, run the following command:
      </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt root"># </code><code class="command">csync2 -xv</code></pre></div><p>
        If you do not have Csync2 (or do not want to use it), copy the DRBD
        configuration files manually to the other node:
      </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt root"># </code><code class="command">scp /etc/drbd.conf bob:/etc/</code>
<code class="prompt root"># </code><code class="command">scp /etc/drbd.d/* bob:/etc/drbd.d/</code></pre></div></li><li class="step"><p>Perform the initial synchronization (see <a class="xref" href="cha-ha-drbd.html#sec-ha-drbd-configure-init" title="23.3.3. Initializing and formatting DRBD resource">Section 23.3.3, “Initializing and formatting DRBD resource”</a>).</p></li><li class="step"><p>
        Reset the cluster's maintenance mode flag:
      </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt root"># </code><code class="command">crm configure property maintenance-mode=false</code></pre></div></li></ol></div></div><section class="sect2" id="sec-ha-drbd-configure-manually" data-id-title="Configuring DRBD manually"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">23.3.1 </span><span class="title-name">Configuring DRBD manually</span></span> <a title="Permalink" class="permalink" href="cha-ha-drbd.html#sec-ha-drbd-configure-manually">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sleha/edit/main/xml/ha_drbd.xml" title="Edit source document"> </a></div></div></div></div></div><div id="id-1.4.5.6.5.5.2" data-id-title="Restricted support for auto promote feature" class="admonition note normal"><img class="symbol" alt="Note" title="Note" src="static/images/icon-note.svg"/><div class="admon-title">Note: Restricted support for <span class="quote">“<span class="quote">auto promote</span>”</span> feature</div><p>
      The DRBD9 <span class="quote">“<span class="quote">auto-promote</span>”</span> feature can automatically promote a
      resource to the primary role when one of its devices is mounted or opened
      for writing.
     </p><p>
      The auto promote feature has currently restricted support.
      With DRBD 9, SUSE supports the same use cases that were also supported
 with DRBD 8. Use cases beyond that, such as setups with more than two
 nodes, are not supported.
     </p></div><p>
     To set up DRBD manually, proceed as follows:
    </p><div class="procedure" id="pro-drbd-configure" data-id-title="Manually configuring DRBD"><div class="title-container"><div class="procedure-title-wrap"><div class="procedure-title"><span class="title-number-name"><span class="title-number">Procedure 23.1: </span><span class="title-name">Manually configuring DRBD </span></span><a title="Permalink" class="permalink" href="cha-ha-drbd.html#pro-drbd-configure">#</a></div></div><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sleha/edit/main/xml/ha_drbd.xml" title="Edit source document"> </a></div></div><div class="procedure-contents"><p>Beginning with DRBD version 8.3, the former configuration file is
      split into separate files, located under the directory
      <code class="filename">/etc/drbd.d/</code>.</p><ol class="procedure" type="1"><li class="step"><p>
       Open the file <code class="filename">/etc/drbd.d/global_common.conf</code>. It
       already contains global, pre-defined values. Go to the
       <code class="literal">startup</code> section and insert these lines:
      </p><div class="verbatim-wrap"><pre class="screen">startup {
    # wfc-timeout degr-wfc-timeout outdated-wfc-timeout
    # wait-after-sb;
    wfc-timeout 100;
    degr-wfc-timeout 120;
}</pre></div><p>
       These options are used to reduce the timeouts when booting, see
       <a class="link" href="https://docs.linbit.com/docs/users-guide-9.0/#ch-configure" target="_blank">https://docs.linbit.com/docs/users-guide-9.0/#ch-configure</a>
       for more details.
      </p></li><li class="step"><p>
       Create the file <code class="filename">/etc/drbd.d/r0.res</code>. Change the
       lines according to your situation and save it:
      </p><div class="verbatim-wrap"><pre class="screen">resource r0 { <span class="callout" id="co-drbd-config-r0">1</span>
  device /dev/drbd0; <span class="callout" id="co-drbd-config-device">2</span>
  disk /dev/disk/by-id/example-disk1; <span class="callout" id="co-drbd-config-disk">3</span>
  meta-disk internal; <span class="callout" id="co-drbd-config-meta-disk">4</span>
  on alice { <span class="callout" id="co-drbd-config-resname">5</span>
    address  192.168.1.10:7788; <span class="callout" id="co-drbd-config-address">6</span>
    node-id 0; <span class="callout" id="co-drbd-config-node-id">7</span>
  }
  on bob { <a class="xref" href="cha-ha-drbd.html#co-drbd-config-resname"><span class="callout">5</span></a>
    address 192.168.1.11:7788; <a class="xref" href="cha-ha-drbd.html#co-drbd-config-address"><span class="callout">6</span></a>
    node-id 1; <a class="xref" href="cha-ha-drbd.html#co-drbd-config-node-id"><span class="callout">7</span></a>
  }
  disk {
    resync-rate 10M; <span class="callout" id="co-drbd-config-syncer-rate">8</span>
  }
  connection-mesh { <span class="callout" id="co-drbd-config-connection-mesh">9</span>
    hosts alice bob;
  }
}</pre></div><div class="calloutlist"><table style="border: 0; "><tr><td style="width: 5%; vertical-align: top; text-align: left; "><p><a href="#co-drbd-config-r0"><span class="callout">1</span></a> </p></td><td style="vertical-align: top; text-align: left; "><p>
         DRBD resource name that allows some association to the service that needs them.
         For example, <code class="systemitem">nfs</code>,
         <code class="systemitem">http</code>, <code class="systemitem">mysql_0</code>,
         <code class="systemitem">postgres_wal</code>, etc.
         Here a more general name <code class="literal">r0</code> is used.
        </p></td></tr><tr><td style="width: 5%; vertical-align: top; text-align: left; "><p><a href="#co-drbd-config-device"><span class="callout">2</span></a> </p></td><td style="vertical-align: top; text-align: left; "><p>
         The device name for DRBD and its minor number.
        </p><p>
         In the example above, the minor number 0 is used for DRBD. The udev
         integration scripts will give you a symbolic link
         <code class="filename">/dev/drbd/by-res/nfs/0</code>. Alternatively, omit
         the device node name in the configuration and use the following
         line instead:
        </p><p>
         <code class="literal">drbd0 minor 0</code> (<code class="literal">/dev/</code> is
         optional) or <code class="literal">/dev/drbd0</code>
        </p></td></tr><tr><td style="width: 5%; vertical-align: top; text-align: left; "><p><a href="#co-drbd-config-disk"><span class="callout">3</span></a> </p></td><td style="vertical-align: top; text-align: left; "><p>
         The raw device that is replicated between nodes. Note, in this
         example the devices are the <span class="emphasis"><em>same</em></span> on both nodes.
         If you need different devices, move the <code class="literal">disk</code>
          parameter into the <code class="literal">on</code> host.
        </p></td></tr><tr><td style="width: 5%; vertical-align: top; text-align: left; "><p><a href="#co-drbd-config-meta-disk"><span class="callout">4</span></a> </p></td><td style="vertical-align: top; text-align: left; "><p>
         The meta-disk parameter usually contains the value
         <code class="literal">internal</code>, but it is possible to specify an
         explicit device to hold the metadata. See
         <a class="link" href="https://docs.linbit.com/docs/users-guide-9.0/#s-metadata" target="_blank">https://docs.linbit.com/docs/users-guide-9.0/#s-metadata</a>
         for more information.
        </p></td></tr><tr><td style="width: 5%; vertical-align: top; text-align: left; "><p><a href="#co-drbd-config-resname"><span class="callout">5</span></a> </p></td><td style="vertical-align: top; text-align: left; "><p>
         The <code class="literal">on</code> section states which host this
         configuration statement applies to.
        </p></td></tr><tr><td style="width: 5%; vertical-align: top; text-align: left; "><p><a href="#co-drbd-config-address"><span class="callout">6</span></a> </p></td><td style="vertical-align: top; text-align: left; "><p>
         The IP address and port number of the respective node. Each
         resource needs an individual port, usually starting with
         <code class="literal">7788</code>. Both ports must be the same for a
          DRBD resource.
        </p></td></tr><tr><td style="width: 5%; vertical-align: top; text-align: left; "><p><a href="#co-drbd-config-node-id"><span class="callout">7</span></a> </p></td><td style="vertical-align: top; text-align: left; "><p>
        The node ID is required when configuring more than two nodes. It
        is a unique, non-negative integer to distinguish the different
        nodes.
      </p></td></tr><tr><td style="width: 5%; vertical-align: top; text-align: left; "><p><a href="#co-drbd-config-syncer-rate"><span class="callout">8</span></a> </p></td><td style="vertical-align: top; text-align: left; "><p>
         The synchronization rate. Set it to one third of the lower of the
         disk- and network bandwidth. It only limits the resynchronization,
         not the replication.
        </p></td></tr><tr><td style="width: 5%; vertical-align: top; text-align: left; "><p><a href="#co-drbd-config-connection-mesh"><span class="callout">9</span></a> </p></td><td style="vertical-align: top; text-align: left; "><p>
       Defines all nodes of a mesh.
       The <code class="option">hosts</code> parameter contains all host names that
       share the same DRBD setup.
    </p></td></tr></table></div></li><li class="step"><p>
      Check the syntax of your configuration files. If the following
      command returns an error, verify your files:
      </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt root"># </code><code class="command">drbdadm dump all</code></pre></div></li><li class="step"><p>Continue with <a class="xref" href="cha-ha-drbd.html#sec-ha-drbd-configure-init" title="23.3.3. Initializing and formatting DRBD resource">Section 23.3.3, “Initializing and formatting DRBD resource”</a>.</p></li></ol></div></div></section><section class="sect2" id="sec-ha-drbd-configure-yast" data-id-title="Configuring DRBD with YaST"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">23.3.2 </span><span class="title-name">Configuring DRBD with YaST</span></span> <a title="Permalink" class="permalink" href="cha-ha-drbd.html#sec-ha-drbd-configure-yast">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sleha/edit/main/xml/ha_drbd.xml" title="Edit source document"> </a></div></div></div></div></div><p>YaST can be used to start with an initial setup of DRBD.
        After you have created your DRBD setup, you can fine-tune the
        generated files manually.
    </p><p>
        However, when you have changed the configuration files,
        do not use the YaST DRBD module anymore. The DRBD module supports
        only a limited set of basic configuration. If you use it again,
        it is likely that the module will not show your changes.
    </p><p>
      To set up DRBD with YaST, proceed as follows:</p><div class="procedure" id="pro-drbd-configure-yast" data-id-title="Using YaST to configure DRBD"><div class="title-container"><div class="procedure-title-wrap"><div class="procedure-title"><span class="title-number-name"><span class="title-number">Procedure 23.2: </span><span class="title-name">Using YaST to configure DRBD </span></span><a title="Permalink" class="permalink" href="cha-ha-drbd.html#pro-drbd-configure-yast">#</a></div></div><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sleha/edit/main/xml/ha_drbd.xml" title="Edit source document"> </a></div></div><div class="procedure-contents"><ol class="procedure" type="1"><li class="step"><p>
     Start YaST and select the configuration module <span class="guimenu">High Availability</span> › <span class="guimenu">DRBD</span>. If you already have a DRBD configuration, YaST
     warns you. YaST will change your configuration and save your
     old DRBD configuration files as <code class="filename">*.YaSTsave</code>.
    </p></li><li class="step"><p>
     Leave the booting flag in <span class="guimenu">Start-up
     Configuration</span> › <span class="guimenu">Booting</span> as it is
     (by default it is <code class="literal">off</code>); do not change that as
     Pacemaker manages this service.
    </p></li><li class="step"><p>If you have a firewall running, enable <span class="guimenu">Open Port in
      Firewall</span>.</p></li><li class="step"><p>Go to the <span class="guimenu">Resource Configuration</span> entry.
      Select <span class="guimenu">Add</span> to create a new resource (see
      <a class="xref" href="cha-ha-drbd.html#fig-ha-drbd-yast-resconfig" title="Resource configuration">Figure 23.2, “Resource configuration”</a>).
    </p><div class="figure" id="fig-ha-drbd-yast-resconfig"><div class="figure-contents"><div class="mediaobject"><a href="images/yast_drbd-resconfig.png"><img src="images/yast_drbd-resconfig.png" width="90%" alt="Resource configuration" title="Resource configuration"/></a></div></div><div class="title-container"><div class="figure-title-wrap"><div class="figure-title"><span class="title-number-name"><span class="title-number">Figure 23.2: </span><span class="title-name">Resource configuration </span></span><a title="Permalink" class="permalink" href="cha-ha-drbd.html#fig-ha-drbd-yast-resconfig">#</a></div></div><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sleha/edit/main/xml/ha_drbd.xml" title="Edit source document"> </a></div></div></div><p>
      The following parameters need to be set:
    </p><div class="variablelist"><dl class="variablelist"><dt id="id-1.4.5.6.5.6.5.5.4.1"><span class="term"><span class="guimenu">Resource Name</span></span></dt><dd><p>The name of the DRBD resource (mandatory)</p></dd><dt id="id-1.4.5.6.5.6.5.5.4.2"><span class="term"><span class="guimenu">Name</span></span></dt><dd><p>The host name of the relevant node</p></dd><dt id="id-1.4.5.6.5.6.5.5.4.3"><span class="term"><span class="guimenu">Address:Port</span></span></dt><dd><p>
          The IP address and port number (default
           <code class="systemitem">7788</code>) for the respective
          node
         </p></dd><dt id="id-1.4.5.6.5.6.5.5.4.4"><span class="term"><span class="guimenu">Device</span></span></dt><dd><p>
          The block device path that is used to access the replicated data.
          If the device contains a minor number, the associated block device
          is usually named <code class="filename">/dev/drbdX</code>, where
          <em class="replaceable">X</em> is the device minor number. If the
          device does not contain a minor number, make sure to add
          <code class="literal">minor 0</code> after the device name.
         </p></dd><dt id="id-1.4.5.6.5.6.5.5.4.5"><span class="term"><span class="guimenu">Disk</span></span></dt><dd><p>
          The raw device that is replicated between both nodes. If you use
          LVM, insert your LVM device name.
         </p></dd><dt id="id-1.4.5.6.5.6.5.5.4.6"><span class="term"><span class="guimenu">Meta-disk</span></span></dt><dd><p>
          The <span class="guimenu">Meta-disk</span> is either set to the value
          <code class="literal">internal</code> or specifies an explicit device
          extended by an index to hold the metadata needed by DRBD.
         </p><p>
          A real device may also be used for multiple DRBD resources. For
          example, if your <span class="guimenu">Meta-Disk</span> is
          <code class="filename">/dev/disk/by-id/example-disk6[0]</code> for the first resource, you may
          use <code class="filename">/dev/disk/by-id/example-disk6[1]</code> for the second resource.
          However, there must be at least 128 MB space for each resource
          available on this disk. The fixed metadata size limits the maximum
          data size that you can replicate.
         </p></dd></dl></div><p>
     All these options are explained in the examples in the
     <code class="filename">/usr/share/doc/packages/drbd/drbd.conf</code> file and in
     the man page of <code class="command">drbd.conf(5)</code>.
    </p></li><li class="step"><p>Click <span class="guimenu">Save</span>.</p></li><li class="step"><p>Click <span class="guimenu">Add</span> to enter the second DRBD resource
     and finish with <span class="guimenu">Save</span>.
    </p></li><li class="step"><p>Close the resource configuration with <span class="guimenu">Ok</span>
      and <span class="guimenu">Finish</span>.
     </p></li><li class="step"><p>If you use LVM with DRBD, it is necessary to change some options
       in the LVM configuration file (see the <span class="guimenu">LVM
       Configuration</span> entry). This change can be done by the
       YaST DRBD module automatically.
     </p><p>
       The disk name of localhost for the DRBD resource and the default filter
       will be rejected in the LVM filter. Only <code class="filename">/dev/drbd</code>
       can be scanned for an LVM device.</p><p>
       For example, if <code class="filename">/dev/disk/by-id/example-disk1</code> is used as a DRBD disk,
       the device name will be inserted as the first entry in the LVM filter.
       To change the filter manually, click the
       <span class="guimenu">Modify LVM Device Filter Automatically</span> check box.
     </p></li><li class="step"><p>Save your changes with <span class="guimenu">Finish</span>.</p></li><li class="step"><p>Continue with <a class="xref" href="cha-ha-drbd.html#sec-ha-drbd-configure-init" title="23.3.3. Initializing and formatting DRBD resource">Section 23.3.3, “Initializing and formatting DRBD resource”</a>.</p></li></ol></div></div></section><section class="sect2" id="sec-ha-drbd-configure-init" data-id-title="Initializing and formatting DRBD resource"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">23.3.3 </span><span class="title-name">Initializing and formatting DRBD resource</span></span> <a title="Permalink" class="permalink" href="cha-ha-drbd.html#sec-ha-drbd-configure-init">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sleha/edit/main/xml/ha_drbd.xml" title="Edit source document"> </a></div></div></div></div></div><p>After you have prepared your system and configured DRBD,
      initialize your disk for the first time:
    </p><div class="procedure"><div class="procedure-contents"><ol class="procedure" type="1"><li class="step"><p>
           On <span class="emphasis"><em>both</em></span> nodes (alice and bob),
           initialize the metadata storage:
          </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt root"># </code><code class="command">drbdadm create-md r0</code>
<code class="prompt root"># </code><code class="command">drbdadm up r0</code></pre></div></li><li class="step"><p>
          To shorten the initial resynchronization of your DRBD resource
          check the following:
         </p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>
            If the DRBD devices on all nodes have the same data (for example,
            by destroying the file system structure with the
            <code class="command">dd</code> command as shown in
            <a class="xref" href="cha-ha-drbd.html#sec-ha-drbd-configure" title="23.3. Setting up DRBD service">Section 23.3, “Setting up DRBD service”</a>), then skip the initial
            resynchronization with the following command (on both nodes):
           </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt root"># </code><code class="command">drbdadm new-current-uuid --clear-bitmap r0/0</code></pre></div><p>The state will be <code class="literal">Secondary/Secondary UpToDate/UpToDate</code></p></li><li class="listitem"><p>
            Otherwise, proceed with the next step.
           </p></li></ul></div></li><li class="step"><p>
          On the primary node alice, start the resynchronization process:
         </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt root"># </code><code class="command">drbdadm primary --force r0</code></pre></div></li><li class="step"><p> Check the status with: </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt root"># </code><code class="command">drbdadm status r0</code>
r0 role:Primary
  disk:UpToDate
  bob role:Secondary
  peer-disk:UpToDate</pre></div></li><li class="step"><p> Create your file system on top of your DRBD device, for
            example: </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt root"># </code><code class="command">mkfs.ext3 /dev/drbd0</code></pre></div></li><li class="step"><p> Mount the file system and use it: </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt root"># </code><code class="command">mount /dev/drbd0 /mnt/</code></pre></div></li></ol></div></div></section><section class="sect2" id="sec-ha-drbd-configure-cluster-resource" data-id-title="Creating cluster resources for DRBD"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">23.3.4 </span><span class="title-name">Creating cluster resources for DRBD</span></span> <a title="Permalink" class="permalink" href="cha-ha-drbd.html#sec-ha-drbd-configure-cluster-resource">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sleha/edit/main/xml/ha_drbd.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    After you have initialized your DRBD device, create a cluster resource to manage
    the DRBD device, and a promotable clone to allow this resource to run on both nodes:
   </p><div class="procedure" id="pro-ha-drbd-configure-cluster-resource" data-id-title="Creating cluster resources for DRBD"><div class="title-container"><div class="procedure-title-wrap"><div class="procedure-title"><span class="title-number-name"><span class="title-number">Procedure 23.3: </span><span class="title-name">Creating cluster resources for DRBD </span></span><a title="Permalink" class="permalink" href="cha-ha-drbd.html#pro-ha-drbd-configure-cluster-resource">#</a></div></div><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sleha/edit/main/xml/ha_drbd.xml" title="Edit source document"> </a></div></div><div class="procedure-contents"><ol class="procedure" type="1"><li class="step"><p>
      Start the <code class="command">crm</code> interactive shell:
     </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt root"># </code><code class="command">crm configure</code></pre></div></li><li class="step"><p>
      Create a primitive for the DRBD resource <code class="literal">r0</code>:
     </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt custom">crm(live)configure# </code><code class="command">primitive drbd-r0 ocf:linbit:drbd \
  params drbd_resource="r0" \
  op monitor interval=15 role=Promoted \
  op monitor interval=30 role=Unpromoted</code></pre></div></li><li class="step"><p>
      Create a promotable clone for the <code class="literal">drbd-r0</code> primitive:
     </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt custom">crm(live)configure# </code><code class="command">clone cl-drbd-r0 drbd-r0 \
  meta promotable="true" promoted-max="1" promoted-node-max="1" \
  clone-max="2" clone-node-max="1" notify="true" interleave=true</code></pre></div></li><li class="step"><p>
      Commit this configuration:
     </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt custom">crm(live)configure# </code><code class="command">commit</code></pre></div></li></ol></div></div></section></section><section class="sect1" id="sec-ha-drbd-migrate" data-id-title="Migrating from DRBD 8 to DRBD 9"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">23.4 </span><span class="title-name">Migrating from DRBD 8 to DRBD 9</span></span> <a title="Permalink" class="permalink" href="cha-ha-drbd.html#sec-ha-drbd-migrate">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sleha/edit/main/xml/ha_drbd.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   Between DRBD 8 (shipped with SUSE Linux Enterprise High Availability 12 SP1) and
   DRBD 9 (shipped with SUSE Linux Enterprise High Availability12 SP2), the metadata format
   has changed. DRBD 9 does not automatically convert previous metadata
   files to the new format.
  </p><p>
   After migrating to 12 SP2 and before starting DRBD, convert the DRBD
   metadata to the version 9 format manually. To do so, use
   <code class="command">drbdadm create-md</code>. No configuration
   needs to be changed.
  </p><div id="id-1.4.5.6.6.4" data-id-title="Restricted support" class="admonition note normal"><img class="symbol" alt="Note" title="Note" src="static/images/icon-note.svg"/><div class="admon-title">Note: Restricted support</div><p>With DRBD 9, SUSE supports the same use cases that were also supported
 with DRBD 8. Use cases beyond that, such as setups with more than two
 nodes, are not supported.</p></div><p>
   DRBD 9 will fall back to be compatible with version 8.
   For three nodes and more, you need to re-create the metadata
   to use DRBD version 9 specific options.
  </p><p>
   If you have a stacked DRBD resource, refer also to <a class="xref" href="cha-ha-drbd.html#sec-ha-drbd-resource-stacking" title="23.5. Creating a stacked DRBD device">Section 23.5, “Creating a stacked DRBD device”</a> for more information.
  </p><p>
   To keep your data and allow to add new nodes without re-creating new
   resources, do the following:
  </p><div class="procedure"><div class="procedure-contents"><ol class="procedure" type="1"><li class="step"><p>
     Set one node in standby mode.
    </p></li><li class="step"><p>
     Update all the DRBD packages on all your nodes. See <a class="xref" href="cha-ha-drbd.html#sec-ha-drbd-install" title="23.2. Installing DRBD services">Section 23.2, “Installing DRBD services”</a>.
    </p></li><li class="step"><p>Add the new node information to your resource configuration:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p><em class="parameter">node-id</em> on every <code class="literal">on</code>
       section.
      </p></li><li class="listitem"><p>
       <em class="parameter">connection-mesh</em> section contains all host names
       in the <em class="parameter">hosts</em> parameter.
      </p></li></ul></div><p>
     See the example configuration in <a class="xref" href="cha-ha-drbd.html#pro-drbd-configure" title="Manually configuring DRBD">Procedure 23.1, “Manually configuring DRBD”</a>.
    </p></li><li class="step"><p>
     Enlarge the space of your DRBD disks when using <code class="literal">internal</code>
     as <code class="literal">meta-disk</code> key. Use a device that supports enlarging
     the space like LVM.
     As an alternative, change to an external disk for metadata
     and use <code class="literal">meta-disk <em class="replaceable">DEVICE</em>;</code>.
    </p></li><li class="step"><p>
     Re-create the metadata based on the new configuration:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt root"># </code><code class="command">drbdadm create-md <em class="replaceable">RESOURCE</em></code></pre></div></li><li class="step"><p>
     Cancel the standby mode.
    </p></li></ol></div></div></section><section class="sect1" id="sec-ha-drbd-resource-stacking" data-id-title="Creating a stacked DRBD device"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">23.5 </span><span class="title-name">Creating a stacked DRBD device</span></span> <a title="Permalink" class="permalink" href="cha-ha-drbd.html#sec-ha-drbd-resource-stacking">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sleha/edit/main/xml/ha_drbd.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   A stacked DRBD device contains two other devices of which at least one
   device is also a DRBD resource. In other words, DRBD adds an additional
   node on top of an already existing DRBD resource (see <a class="xref" href="cha-ha-drbd.html#fig-ha-drbd-resource-stacking" title="Resource stacking">Figure 23.3, “Resource stacking”</a>). Such a replication setup
   can be used for backup and disaster recovery purposes.
  </p><div class="figure" id="fig-ha-drbd-resource-stacking"><div class="figure-contents"><div class="mediaobject"><a href="images/ha_stacked_drbd.png"><img src="images/ha_stacked_drbd.png" width="50%" alt="Resource stacking" title="Resource stacking"/></a></div></div><div class="title-container"><div class="figure-title-wrap"><div class="figure-title"><span class="title-number-name"><span class="title-number">Figure 23.3: </span><span class="title-name">Resource stacking </span></span><a title="Permalink" class="permalink" href="cha-ha-drbd.html#fig-ha-drbd-resource-stacking">#</a></div></div><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sleha/edit/main/xml/ha_drbd.xml" title="Edit source document"> </a></div></div></div><p>
   Three-way replication uses asynchronous (DRBD protocol A) and
   synchronous replication (DRBD protocol C). The asynchronous part is used for
   the stacked resource whereas the synchronous part is used for the backup.
  </p><p>
   Your production environment uses the stacked device. For example,
   if you have a DRBD device <code class="filename">/dev/drbd0</code> and a stacked
   device <code class="filename">/dev/drbd10</code> on top, the file system will
   be created on <code class="filename">/dev/drbd10</code>, see <a class="xref" href="cha-ha-drbd.html#exa-ha-drbd-stacked-drbd" title="Configuration of a three-node stacked DRBD resource">Example 23.1, “Configuration of a three-node stacked DRBD resource”</a> for more details.
  </p><div class="example" id="exa-ha-drbd-stacked-drbd" data-id-title="Configuration of a three-node stacked DRBD resource"><div class="title-container"><div class="example-title-wrap"><div class="example-title"><span class="title-number-name"><span class="title-number">Example 23.1: </span><span class="title-name">Configuration of a three-node stacked DRBD resource </span></span><a title="Permalink" class="permalink" href="cha-ha-drbd.html#exa-ha-drbd-stacked-drbd">#</a></div></div><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sleha/edit/main/xml/ha_drbd.xml" title="Edit source document"> </a></div></div><div class="example-contents"><div class="verbatim-wrap"><pre class="screen"># /etc/drbd.d/r0.res
resource r0 {
  protocol C;
  device    /dev/drbd0;
  disk      /dev/disk/by-id/example-disk1;
  meta-disk internal;

  on amsterdam-alice {
    address    192.168.1.1:7900;
  }

  on amsterdam-bob {
    address    192.168.1.2:7900;
  }
}

resource r0-U {
  protocol A;
  device     /dev/drbd10;

  stacked-on-top-of r0 {
    address    192.168.2.1:7910;
  }

  on berlin-charlie {
    disk       /dev/disk/by-id/example-disk10;
    address    192.168.2.2:7910; # Public IP of the backup node
    meta-disk  internal;
  }
}</pre></div></div></div></section><section class="sect1" id="sec-ha-drbd-fencing" data-id-title="Using resource-level fencing with STONITH"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">23.6 </span><span class="title-name">Using resource-level fencing with STONITH</span></span> <a title="Permalink" class="permalink" href="cha-ha-drbd.html#sec-ha-drbd-fencing">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sleha/edit/main/xml/ha_drbd.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   When a DRBD replication link becomes interrupted, Pacemaker tries to promote
   the DRBD resource to another node. To prevent Pacemaker from starting a service
   with outdated data, enable resource-level fencing in the DRBD configuration
   file.
  </p><p>
    The fencing policy can have different values (see man page <code class="command">drbdsetup</code> and the
     <code class="option">--fencing</code> option).
    As a SUSE Linux Enterprise High Availability cluster is normally used with a STONITH device, the value
    <code class="constant">resource-and-stonith</code> is used in
    <a class="xref" href="cha-ha-drbd.html#ex-ha-drbd-fencing" title="Configuration of DRBD with resource-level fencing using the Cluster Information Base (CIB)">Example 23.2, “Configuration of DRBD with resource-level fencing using the Cluster
    Information Base (CIB)”</a>.
  </p><div class="example" id="ex-ha-drbd-fencing" data-id-title="Configuration of DRBD with resource-level fencing using the Cluster Information Base (CIB)"><div class="title-container"><div class="example-title-wrap"><div class="example-title"><span class="title-number-name"><span class="title-number">Example 23.2: </span><span class="title-name">Configuration of DRBD with resource-level fencing using the Cluster
    Information Base (CIB) </span></span><a title="Permalink" class="permalink" href="cha-ha-drbd.html#ex-ha-drbd-fencing">#</a></div></div><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sleha/edit/main/xml/ha_drbd.xml" title="Edit source document"> </a></div></div><div class="example-contents"><div class="verbatim-wrap"><pre class="screen">resource <em class="replaceable">RESOURCE</em> {
  net {
    fencing resource-and-stonith;
    # ...
  }
  handlers {
    fence-peer "/usr/lib/drbd/crm-fence-peer.9.sh";
    after-resync-target "/usr/lib/drbd/crm-unfence-peer.9.sh";
    # ...
  }
  ...
}</pre></div></div></div><p>If the DRBD replication link becomes disconnected, DRBD does the
  following:</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>DRBD calls the <code class="command">crm-fence-peer.9.sh</code> script.</p></li><li class="listitem"><p>The script contacts the cluster manager.
    </p></li><li class="listitem"><p>The script determines the Pacemaker resource associated with this
     DRBD resource.</p></li><li class="listitem"><p>The script ensures that the DRBD resource no longer gets
    promoted to any other node. It stays on the currently active one.</p></li><li class="listitem"><p>If the replication link becomes connected again and DRBD
    completes its synchronization process, then the constraint is removed.
    The cluster manager is now free to promote the resource.
    </p></li></ol></div></section><section class="sect1" id="sec-ha-drbd-test" data-id-title="Testing the DRBD service"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">23.7 </span><span class="title-name">Testing the DRBD service</span></span> <a title="Permalink" class="permalink" href="cha-ha-drbd.html#sec-ha-drbd-test">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sleha/edit/main/xml/ha_drbd.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   If the install and configuration procedures worked as expected, you are
   ready to run a basic test of the DRBD functionality. This test also helps
   with understanding how the software works.
  </p><div class="procedure" id="pro-drbd-test"><div class="procedure-contents"><ol class="procedure" type="1"><li class="step"><p>
     Test the DRBD service on alice.
    </p><ol type="a" class="substeps"><li class="step"><p>
       Open a terminal console, then log in as
       <code class="systemitem">root</code>.
      </p></li><li class="step"><p>
       Create a mount point on alice, such as
       <code class="filename">/srv/r0</code>:
      </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt root"># </code><code class="command">mkdir -p /srv/r0</code></pre></div></li><li class="step"><p>
       Mount the <code class="command">drbd</code> device:
      </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt root"># </code><code class="command">mount -o rw /dev/drbd0 /srv/r0</code></pre></div></li><li class="step"><p>
       Create a file from the primary node:
      </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt root"># </code><code class="command">touch /srv/r0/from_alice</code></pre></div></li><li class="step"><p>
       Unmount the disk on alice:
      </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt root"># </code><code class="command">umount /srv/r0</code></pre></div></li><li class="step"><p>
       Downgrade the DRBD service on alice by typing the following
       command on alice:
      </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt root"># </code><code class="command">drbdadm secondary r0</code></pre></div></li></ol></li><li class="step"><p>
     Test the DRBD service on bob.
    </p><ol type="a" class="substeps"><li class="step"><p>
       Open a terminal console, then log in as <code class="systemitem">root</code>
       on bob.
      </p></li><li class="step"><p>
       On bob, promote the DRBD service to primary:
      </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt root"># </code><code class="command">drbdadm primary r0</code></pre></div></li><li class="step"><p>
       On bob, check to see if bob is primary:
      </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt root"># </code><code class="command">drbdadm status r0</code></pre></div></li><li class="step"><p> On bob, create a mount point such as
        <code class="filename">/srv/r0</code>: </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt root"># </code><code class="command">mkdir /srv/r0</code></pre></div></li><li class="step"><p>
       On bob, mount the DRBD device:
      </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt root"># </code><code class="command">mount -o rw /dev/drbd0 /srv/r0</code></pre></div></li><li class="step"><p>
       Verify that the file you created on alice exists:
      </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt root"># </code><code class="command">ls /srv/r0/from_alice</code></pre></div><p> The <code class="filename">/srv/r0/from_alice</code> file should be
       listed. </p></li></ol></li><li class="step"><p>
     If the service is working on both nodes, the DRBD setup is complete.
    </p></li><li class="step"><p>
     Set up alice as the primary again.
    </p><ol type="a" class="substeps"><li class="step"><p>
       Dismount the disk on bob by typing the following command on
       bob:
      </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt root"># </code><code class="command">umount /srv/r0</code></pre></div></li><li class="step"><p>
       Downgrade the DRBD service on bob by typing the following
       command on bob:
      </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt root"># </code><code class="command">drbdadm secondary r0</code></pre></div></li><li class="step"><p>
       On alice, promote the DRBD service to primary:
      </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt root"># </code><code class="command">drbdadm primary r0</code></pre></div></li><li class="step"><p>
       On alice, check to see if alice is primary:
      </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt root"># </code><code class="command">drbdadm status r0</code></pre></div></li></ol></li><li class="step"><p>
     To get the service to automatically start and fail over if the server
     has a problem, you can set up DRBD as a high availability service with
     Pacemaker/Corosync. For information about installing and
     configuring for SUSE Linux Enterprise 15 SP6 see
     <a class="xref" href="part-config.html" title="Part II. Configuration and administration">Part II, “Configuration and administration”</a>.
    </p></li></ol></div></div></section><section class="sect1" id="sec-ha-drbd-monitor" data-id-title="Monitoring DRBD devices"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">23.8 </span><span class="title-name">Monitoring DRBD devices</span></span> <a title="Permalink" class="permalink" href="cha-ha-drbd.html#sec-ha-drbd-monitor">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sleha/edit/main/xml/ha_drbd.xml" title="Edit source document"> </a></div></div></div></div></div><p>DRBD comes with the utility <code class="command">drbdmon</code> which offers
   real time monitoring. It shows all the configured resources and their
   problems.
  </p><div class="figure" id="id-1.4.5.6.10.3"><div class="figure-contents"><div class="mediaobject"><a href="images/drbd-drbdmon-ok.png"><img src="images/drbd-drbdmon-ok.png" width="70%" alt="Showing a good connection by drbdmon" title="Showing a good connection by drbdmon"/></a></div></div><div class="title-container"><div class="figure-title-wrap"><div class="figure-title"><span class="title-number-name"><span class="title-number">Figure 23.4: </span><span class="title-name">Showing a good connection by <code class="command">drbdmon</code> </span></span><a title="Permalink" class="permalink" href="cha-ha-drbd.html#id-1.4.5.6.10.3">#</a></div></div><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sleha/edit/main/xml/ha_drbd.xml" title="Edit source document"> </a></div></div></div><p>In case of problems, <code class="command">drbdadm</code> shows an error message:
  </p><div class="figure" id="id-1.4.5.6.10.5"><div class="figure-contents"><div class="mediaobject"><a href="images/drbd-drbdmon-bad.png"><img src="images/drbd-drbdmon-bad.png" width="70%" alt="Showing a bad connection by drbdmon" title="Showing a bad connection by drbdmon"/></a></div></div><div class="title-container"><div class="figure-title-wrap"><div class="figure-title"><span class="title-number-name"><span class="title-number">Figure 23.5: </span><span class="title-name">Showing a bad connection by <code class="command">drbdmon</code> </span></span><a title="Permalink" class="permalink" href="cha-ha-drbd.html#id-1.4.5.6.10.5">#</a></div></div><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sleha/edit/main/xml/ha_drbd.xml" title="Edit source document"> </a></div></div></div></section><section class="sect1" id="sec-ha-drbd-tuning" data-id-title="Tuning DRBD"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">23.9 </span><span class="title-name">Tuning DRBD</span></span> <a title="Permalink" class="permalink" href="cha-ha-drbd.html#sec-ha-drbd-tuning">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sleha/edit/main/xml/ha_drbd.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   There are several ways to tune DRBD:
  </p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>
     Use an external disk for your metadata. This might help, at the cost of
     maintenance ease.
    </p></li><li class="listitem"><p>
     Tune your network connection, by changing the receive and send buffer
     settings via <code class="command">sysctl</code>.
    </p></li><li class="listitem"><p>
     Change the <code class="systemitem">max-buffers</code>,
     <code class="systemitem">max-epoch-size</code> or both in the DRBD
     configuration.
    </p></li><li class="listitem"><p>
     Increase the <code class="systemitem">al-extents</code> value, depending on
     your IO patterns.
    </p></li><li class="listitem"><p>
     If you have a hardware RAID controller with a BBU (<span class="emphasis"><em>Battery
     Backup Unit</em></span>), you might benefit from setting
     <code class="systemitem">no-disk-flushes</code>,
     <code class="systemitem">no-disk-barrier</code> and/or
     <code class="systemitem">no-md-flushes</code>.
    </p></li><li class="listitem"><p>
     Enable read-balancing depending on your workload. See
     <a class="link" href="https://www.linbit.com/en/read-balancing/" target="_blank">https://www.linbit.com/en/read-balancing/</a> for
     more details.
    </p></li></ol></div></section><section class="sect1" id="sec-ha-drbd-trouble" data-id-title="Troubleshooting DRBD"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">23.10 </span><span class="title-name">Troubleshooting DRBD</span></span> <a title="Permalink" class="permalink" href="cha-ha-drbd.html#sec-ha-drbd-trouble">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sleha/edit/main/xml/ha_drbd.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   The DRBD setup involves many components and problems may arise
   from different sources. The following sections cover several common
   scenarios and recommend various solutions.
  </p><section class="sect2" id="sec-ha-drbd-trouble-config" data-id-title="Configuration"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">23.10.1 </span><span class="title-name">Configuration</span></span> <a title="Permalink" class="permalink" href="cha-ha-drbd.html#sec-ha-drbd-trouble-config">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sleha/edit/main/xml/ha_drbd.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    If the initial DRBD setup does not work as expected, there is probably
    something wrong with your configuration.
   </p><p>
    To get information about the configuration:
   </p><div class="procedure"><div class="procedure-contents"><ol class="procedure" type="1"><li class="step"><p>
      Open a terminal console, then log in as <code class="systemitem">root</code>.
     </p></li><li class="step"><p>
      Test the configuration file by running <code class="command">drbdadm</code> with
      the <code class="command">-d</code> option. Enter the following command:
     </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt root"># </code><code class="command">drbdadm -d adjust r0</code></pre></div><p>
      In a dry run of the <code class="command">adjust</code> option,
      <code class="command">drbdadm</code> compares the actual configuration of the
      DRBD resource with your DRBD configuration file, but it does not
      execute the calls. Review the output to make sure you know the source
      and cause of any errors.
     </p></li><li class="step"><p>
      If there are errors in the <code class="filename">/etc/drbd.d/*</code> and
      <code class="filename">drbd.conf</code> files, correct them before continuing.
     </p></li><li class="step"><p>
      If the partitions and settings are correct, run
      <code class="command">drbdadm</code> again without the <code class="command">-d</code>
      option.
     </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt root"># </code><code class="command">drbdadm adjust r0</code></pre></div><p>
      This applies the configuration file to the DRBD resource.
     </p></li></ol></div></div></section><section class="sect2" id="sec-ha-drbd-hostnames" data-id-title="Host names"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">23.10.2 </span><span class="title-name">Host names</span></span> <a title="Permalink" class="permalink" href="cha-ha-drbd.html#sec-ha-drbd-hostnames">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sleha/edit/main/xml/ha_drbd.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    For DRBD, host names are case-sensitive (<code class="systemitem">Node0</code>
    would be a different host than <code class="systemitem">node0</code>), and
    compared to the host name as stored in the Kernel (see the
    <code class="command">uname -n</code> output).
   </p><p>
    If you have several network devices and want to use a dedicated network
    device, the host name will likely not resolve to the used IP address. In
    this case, use the parameter <code class="literal">disable-ip-verification</code>.
   </p></section><section class="sect2" id="sec-ha-drbd-port" data-id-title="TCP port 7788"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">23.10.3 </span><span class="title-name">TCP port 7788</span></span> <a title="Permalink" class="permalink" href="cha-ha-drbd.html#sec-ha-drbd-port">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sleha/edit/main/xml/ha_drbd.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    If your system cannot connect to the peer, this might be a problem with
    your local firewall. By default, DRBD uses the TCP port
    <code class="literal">7788</code> to access the other node. Make sure that this
    port is accessible on both nodes.
   </p></section><section class="sect2" id="sec-ha-drbd-trouble-broken" data-id-title="DRBD devices broken after reboot"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">23.10.4 </span><span class="title-name">DRBD devices broken after reboot</span></span> <a title="Permalink" class="permalink" href="cha-ha-drbd.html#sec-ha-drbd-trouble-broken">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sleha/edit/main/xml/ha_drbd.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    In cases when DRBD does not know which of the real devices holds the
    latest data, it changes to a split-brain condition. In this case, the
    respective DRBD subsystems come up as secondary and do not connect to
    each other. In this case, the following message can be found in the
    logging data:
   </p><div class="verbatim-wrap"><pre class="screen">Split-Brain detected, dropping connection!</pre></div><p>
    To resolve this situation, enter the following commands on the node which has
    data to be discarded:
   </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt root"># </code><code class="command">drbdadm secondary r0</code></pre></div><p>
    If the state is in <code class="literal">WFconnection</code>, disconnect first:
   </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt root"># </code><code class="command">drbdadm disconnect r0</code></pre></div><p>
    On the node which has the latest data enter the following:
   </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt root"># </code><code class="command">drbdadm connect  --discard-my-data r0</code></pre></div><p>
    That resolves the issue by overwriting one node's data with the peer's
    data, therefore getting a consistent view on both nodes.
   </p></section></section><section class="sect1" id="sec-ha-drbd-more" data-id-title="For more information"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">23.11 </span><span class="title-name">For more information</span></span> <a title="Permalink" class="permalink" href="cha-ha-drbd.html#sec-ha-drbd-more">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sleha/edit/main/xml/ha_drbd.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   The following open source resources are available for DRBD:
  </p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>
     The project home page <a class="link" href="https://www.drbd.org" target="_blank">https://www.drbd.org</a>.
    </p></li><li class="listitem"><p>
     See <span class="intraxref">Article “Highly Available NFS Storage with DRBD and Pacemaker”</span>.
    </p></li><li class="listitem"><p>
     <a class="link" href="https://clusterlabs.org/wiki/DRBD_HowTo_1.0" target="_blank">https://clusterlabs.org/wiki/DRBD_HowTo_1.0</a> by the
     Linux Pacemaker Cluster Stack Project.
    </p></li><li class="listitem"><p>
     The following man pages for DRBD are available in the distribution:
     <code class="command">drbd(8)</code>, <code class="command">drbdmeta(8)</code>,
     <code class="command">drbdsetup(8)</code>, <code class="command">drbdadm(8)</code>,
     <code class="command">drbd.conf(5)</code>.
    </p></li><li class="listitem"><p>
     Find a commented example configuration for DRBD at
     <code class="filename">/usr/share/doc/packages/drbd-utils/drbd.conf.example</code>.
    </p></li><li class="listitem"><p>
     Furthermore, for easier storage administration across your cluster, see
     the recent announcement about the <em class="citetitle">DRBD-Manager</em>
     at <a class="link" href="https://www.linbit.com/en/drbd-manager/" target="_blank">https://www.linbit.com/en/drbd-manager/</a>.
    </p></li></ul></div></section></section><nav class="bottom-pagination"><div><a class="pagination-link prev" href="cha-ha-gfs2.html"><span class="pagination-relation">Previous</span><span class="pagination-label"><span class="title-number">Chapter 22 </span>GFS2</span></a> </div><div><a class="pagination-link next" href="cha-ha-clvm.html"><span class="pagination-relation">Next</span><span class="pagination-label"><span class="title-number">Chapter 24 </span>Cluster logical volume manager (Cluster LVM)</span></a> </div></nav></article><aside id="_side-toc-page" class="side-toc"><div class="side-title">On this page</div><div class="toc"><ul><li><span class="sect1"><a href="cha-ha-drbd.html#sec-ha-drbd-overview"><span class="title-number">23.1 </span><span class="title-name">Conceptual overview</span></a></span></li><li><span class="sect1"><a href="cha-ha-drbd.html#sec-ha-drbd-install"><span class="title-number">23.2 </span><span class="title-name">Installing DRBD services</span></a></span></li><li><span class="sect1"><a href="cha-ha-drbd.html#sec-ha-drbd-configure"><span class="title-number">23.3 </span><span class="title-name">Setting up DRBD service</span></a></span></li><li><span class="sect1"><a href="cha-ha-drbd.html#sec-ha-drbd-migrate"><span class="title-number">23.4 </span><span class="title-name">Migrating from DRBD 8 to DRBD 9</span></a></span></li><li><span class="sect1"><a href="cha-ha-drbd.html#sec-ha-drbd-resource-stacking"><span class="title-number">23.5 </span><span class="title-name">Creating a stacked DRBD device</span></a></span></li><li><span class="sect1"><a href="cha-ha-drbd.html#sec-ha-drbd-fencing"><span class="title-number">23.6 </span><span class="title-name">Using resource-level fencing with STONITH</span></a></span></li><li><span class="sect1"><a href="cha-ha-drbd.html#sec-ha-drbd-test"><span class="title-number">23.7 </span><span class="title-name">Testing the DRBD service</span></a></span></li><li><span class="sect1"><a href="cha-ha-drbd.html#sec-ha-drbd-monitor"><span class="title-number">23.8 </span><span class="title-name">Monitoring DRBD devices</span></a></span></li><li><span class="sect1"><a href="cha-ha-drbd.html#sec-ha-drbd-tuning"><span class="title-number">23.9 </span><span class="title-name">Tuning DRBD</span></a></span></li><li><span class="sect1"><a href="cha-ha-drbd.html#sec-ha-drbd-trouble"><span class="title-number">23.10 </span><span class="title-name">Troubleshooting DRBD</span></a></span></li><li><span class="sect1"><a href="cha-ha-drbd.html#sec-ha-drbd-more"><span class="title-number">23.11 </span><span class="title-name">For more information</span></a></span></li></ul></div><div class="side-title">Share this page</div><ul class="share"><li><a id="_share-fb" href="#" title="Facebook"> </a></li><li><a id="_share-in" href="#" title="LinkedIn"> </a></li><li><a id="_share-tw" href="#" title="Twitter/X"> </a></li><li><a id="_share-mail" href="#" title="E-Mail"> </a></li><li><a id="_print-button" href="#" title="Print this page"> </a></li></ul> </aside></main><footer id="_footer"><div class="growth-inhibitor"><div class="copy"><span class="copy__rights">© SUSE
                 2024</span></div></div></footer></body></html>